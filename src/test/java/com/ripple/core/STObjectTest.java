package com.ripple.core;

import static junit.framework.TestCase.assertEquals;
import static org.junit.Assert.assertTrue;

import java.util.ArrayList;
import java.util.Collections;

import org.json.JSONObject;
import org.junit.Test;

import com.mbcu.mmm.sequences.Counter;
import com.ripple.core.coretypes.Amount;
import com.ripple.core.coretypes.STArray;
import com.ripple.core.coretypes.STObject;
import com.ripple.core.fields.Field;
import com.ripple.core.serialized.enums.EngineResult;
import com.ripple.core.serialized.enums.LedgerEntryType;
import com.ripple.core.types.known.sle.LedgerEntry;
import com.ripple.core.types.known.sle.entries.AccountRoot;
import com.ripple.core.types.known.sle.entries.Offer;
import com.ripple.core.types.known.tx.Transaction;
import com.ripple.core.types.known.tx.result.AffectedNode;
import com.ripple.core.types.known.tx.result.TransactionMeta;

public class STObjectTest {

	@Test
	public void testNestedObjectSerialization() throws Exception {
		String rippleLibHex = "120007220000000024000195F964400000170A53AC2065D5460561EC9DE000000000000000000000000000"
				+ "494C53000000000092D705968936C419CE614BF264B5EEB1CEA47FF468400000000000000A7321028472865"
				+ "AF4CB32AA285834B57576B7290AA8C31B459047DB27E16F418D6A71667447304502202ABE08D5E78D1E74A4"
				+ "C18F2714F64E87B8BD57444AFA5733109EB3C077077520022100DB335EE97386E4C0591CAC024D50E9230D8"
				+ "F171EEB901B5E5E4BD6D1E0AEF98C811439408A69F0895E62149CFCC006FB89FA7D1E6E5D";

		String rippledHex = "120007220000000024000195F964400000170A53AC2065D5460561EC9DE000000000000000000000000000494C53000000000092D705968936C419CE614BF264B5EEB1CEA47FF468400000000000000A7321028472865AF4CB32AA285834B57576B7290AA8C31B459047DB27E16F418D6A71667447304502202ABE08D5E78D1E74A4C18F2714F64E87B8BD57444AFA5733109EB3C077077520022100DB335EE97386E4C0591CAC024D50E9230D8F171EEB901B5E5E4BD6D1E0AEF98C811439408A69F0895E62149CFCC006FB89FA7D1E6E5D";

		String json = "{" + "  \"Account\": \"raD5qJMAShLeHZXf9wjUmo6vRK4arj9cF3\"," + "  \"Fee\": \"10\","
				+ "  \"Flags\": 0," + "  \"Sequence\": 103929,"
				+ "  \"SigningPubKey\": \"028472865AF4CB32AA285834B57576B7290AA8C31B459047DB27E16F418D6A7166\","
				+ "  \"TakerGets\": {" + "    \"currency\": \"ILS\","
				+ "    \"issuer\": \"rNPRNzBB92BVpAhhZr4iXDTveCgV5Pofm9\"," + "    \"value\": \"1694.768\"" + "  },"
				+ "  \"TakerPays\": \"98957503520\"," + "  \"TransactionType\": \"OfferCreate\","
				+ "  \"TxnSignature\": \"304502202ABE08D5E78D1E74A4C18F2714F64E87B8BD57444AFA5733109EB3C077077520022100DB335EE97386E4C0591CAC024D50E9230D8F171EEB901B5E5E4BD6D1E0AEF98C\","
				+ "  \"hash\": \"232E91912789EA1419679A4AA920C22CFC7C6B601751D6CBE89898C26D7F4394\"," + "  \"metaData\": {"
				+ "    \"AffectedNodes\": [" + "      {" + "        \"CreatedNode\": {"
				+ "          \"LedgerEntryType\": \"Offer\","
				+ "          \"LedgerIndex\": \"3596CE72C902BAFAAB56CC486ACAF9B4AFC67CF7CADBB81A4AA9CBDC8C5CB1AA\","
				+ "          \"NewFields\": {" + "            \"Account\": \"raD5qJMAShLeHZXf9wjUmo6vRK4arj9cF3\","
				+ "            \"BookDirectory\": \"62A3338CAF2E1BEE510FC33DE1863C56948E962CCE173CA55C14BE8A20D7F000\","
				+ "            \"OwnerNode\": \"000000000000000E\"," + "            \"Sequence\": 103929,"
				+ "            \"TakerGets\": {" + "              \"currency\": \"ILS\","
				+ "              \"issuer\": \"rNPRNzBB92BVpAhhZr4iXDTveCgV5Pofm9\"," + "              \"value\": \"1694.768\""
				+ "            }," + "            \"TakerPays\": \"98957503520\"" + "          }" + "        }" + "      },"
				+ "      {" + "        \"CreatedNode\": {" + "          \"LedgerEntryType\": \"DirectoryNode\","
				+ "          \"LedgerIndex\": \"62A3338CAF2E1BEE510FC33DE1863C56948E962CCE173CA55C14BE8A20D7F000\","
				+ "          \"NewFields\": {" + "            \"ExchangeRate\": \"5C14BE8A20D7F000\","
				+ "            \"RootIndex\": \"62A3338CAF2E1BEE510FC33DE1863C56948E962CCE173CA55C14BE8A20D7F000\","
				+ "            \"TakerGetsCurrency\": \"000000000000000000000000494C530000000000\","
				+ "            \"TakerGetsIssuer\": \"92D705968936C419CE614BF264B5EEB1CEA47FF4\"" + "          }" + "        }"
				+ "      }," + "      {" + "        \"ModifiedNode\": {" + "          \"FinalFields\": {"
				+ "            \"Flags\": 0," + "            \"IndexPrevious\": \"0000000000000000\","
				+ "            \"Owner\": \"raD5qJMAShLeHZXf9wjUmo6vRK4arj9cF3\","
				+ "            \"RootIndex\": \"801C5AFB5862D4666D0DF8E5BE1385DC9B421ED09A4269542A07BC0267584B64\""
				+ "          }," + "          \"LedgerEntryType\": \"DirectoryNode\","
				+ "          \"LedgerIndex\": \"AB03F8AA02FFA4635E7CE2850416AEC5542910A2B4DBE93C318FEB08375E0DB5\""
				+ "        }" + "      }," + "      {" + "        \"ModifiedNode\": {" + "          \"FinalFields\": {"
				+ "            \"Account\": \"raD5qJMAShLeHZXf9wjUmo6vRK4arj9cF3\","
				+ "            \"Balance\": \"106861218302\"," + "            \"Flags\": 0," + "            \"OwnerCount\": 9,"
				+ "            \"Sequence\": 103930" + "          }," + "          \"LedgerEntryType\": \"AccountRoot\","
				+ "          \"LedgerIndex\": \"CF23A37E39A571A0F22EC3E97EB0169936B520C3088963F16C5EE4AC59130B1B\","
				+ "          \"PreviousFields\": {" + "            \"Balance\": \"106861218312\","
				+ "            \"OwnerCount\": 8," + "            \"Sequence\": 103929" + "          },"
				+ "          \"PreviousTxnID\": \"DE15F43F4A73C4F6CB1C334D9E47BDE84467C0902796BB81D4924885D1C11E6D\","
				+ "          \"PreviousTxnLgrSeq\": 3225338" + "        }" + "      }" + "    ],"
				+ "    \"TransactionIndex\": 0," + "    \"TransactionResult\": \"tesSUCCESS\"" + "  }" + "}";

		JSONObject txJson = new JSONObject(json);
		STObject meta = STObject.fromJSONObject((JSONObject) txJson.remove("metaData"));
		STObject tx = STObject.fromJSONObject(txJson);

		String rippledMetaHex = "201C00000000F8E311006F563596CE72C902BAFAAB56CC486ACAF9B4AFC67CF7CADBB81A4AA9CBDC8C5CB1AAE824000195F934000000000000000E501062A3338CAF2E1BEE510FC33DE1863C56948E962CCE173CA55C14BE8A20D7F00064400000170A53AC2065D5460561EC9DE000000000000000000000000000494C53000000000092D705968936C419CE614BF264B5EEB1CEA47FF4811439408A69F0895E62149CFCC006FB89FA7D1E6E5DE1E1E31100645662A3338CAF2E1BEE510FC33DE1863C56948E962CCE173CA55C14BE8A20D7F000E8365C14BE8A20D7F0005862A3338CAF2E1BEE510FC33DE1863C56948E962CCE173CA55C14BE8A20D7F0000311000000000000000000000000494C530000000000041192D705968936C419CE614BF264B5EEB1CEA47FF4E1E1E511006456AB03F8AA02FFA4635E7CE2850416AEC5542910A2B4DBE93C318FEB08375E0DB5E7220000000032000000000000000058801C5AFB5862D4666D0DF8E5BE1385DC9B421ED09A4269542A07BC0267584B64821439408A69F0895E62149CFCC006FB89FA7D1E6E5DE1E1E511006125003136FA55DE15F43F4A73C4F6CB1C334D9E47BDE84467C0902796BB81D4924885D1C11E6D56CF23A37E39A571A0F22EC3E97EB0169936B520C3088963F16C5EE4AC59130B1BE624000195F92D000000086240000018E16CCA08E1E7220000000024000195FA2D000000096240000018E16CC9FE811439408A69F0895E62149CFCC006FB89FA7D1E6E5DE1E1F1031000";
		String actual = tx.toHex();

		assertEquals(rippledHex, rippleLibHex);
		assertEquals(rippledHex, actual);
		assertEquals(rippledMetaHex.length(), meta.toHex().length());
		assertEquals(rippledMetaHex, meta.toHex());
	}

	String metaJson = "{\"AffectedNodes\": [{\"ModifiedNode\": {\"FinalFields\": {\"Account\": \"rwMyB1diFJ7xqEKYGYgk9tKrforvTr33M5\","
			+ "\"Balance\": \"286000447\"," + "\"Flags\": 0," + "\"OwnerCount\": 4," + "\"Sequence\": 35},"
			+ "\"LedgerEntryType\": \"AccountRoot\","
			+ "\"LedgerIndex\": \"32FE2333B117B257F3AB58E1CB15A6533DC27FDD61FEB1027858D367B40B559A\","
			+ "\"PreviousFields\": {\"Balance\": \"286000463\"," + "\"Sequence\": 34},"
			+ "\"PreviousTxnID\": \"33562B82489F263F173801272D02178C0018A40ACFDC84B59976CE7C163F41FC\","
			+ "\"PreviousTxnLgrSeq\": 2681281}},"
			+ "{\"ModifiedNode\": {\"FinalFields\": {\"Account\": \"rP1coskQzayaQ9geMdJgAV5f3tNZcHghzH\","
			+ "\"Balance\": \"99249214171\"," + "\"Flags\": 0," + "\"OwnerCount\": 3," + "\"Sequence\": 177},"
			+ "\"LedgerEntryType\": \"AccountRoot\","
			+ "\"LedgerIndex\": \"D66D0EC951FD5707633BEBE74DB18B6D2DDA6771BA0FBF079AD08BFDE6066056\","
			+ "\"PreviousFields\": {\"Balance\": \"99249214170\"},"
			+ "\"PreviousTxnID\": \"33562B82489F263F173801272D02178C0018A40ACFDC84B59976CE7C163F41FC\","
			+ "\"PreviousTxnLgrSeq\": 2681281}}]," + "\"TransactionIndex\": 2," + "\"TransactionResult\": \"tesSUCCESS\"}";

	String error = "{\r\n  \"AffectedNodes\": [{\r\n    \"CreatedNode\": {\r\n      \"LedgerEntryType\": \"Offer\",\r\n      \"LedgerIndex\": \"60B13F57D2B799D2C05EFB11C7C032D35D9320738AB07C6BDDAC3C10BBCFDFF1\",\r\n      \"NewFields\": {\r\n        \"Account\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\r\n        \"BookDirectory\": \"7E984AD10069041B9B957C73D05AF2AB3D117C0CCAF7FDA5500AC40B67AED936\",\r\n        \"OwnerNode\": \"000000000000000F\",\r\n        \"Sequence\": 4740,\r\n        \"TakerGets\": {\r\n          \"currency\": \"JPY\",\r\n          \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n          \"value\": \"3300\"\r\n        },\r\n        \"TakerPays\": {\r\n          \"currency\": \"RJP\",\r\n          \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n          \"value\": \"0.1\"\r\n        }\r\n      }\r\n    }\r\n  }, {\r\n    \"ModifiedNode\": {\r\n      \"FinalFields\": {\r\n        \"Account\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\r\n        \"Balance\": \"6060125313\",\r\n        \"Flags\": 0,\r\n        \"OwnerCount\": 10,\r\n        \"Sequence\": 4741\r\n      },\r\n      \"LedgerEntryType\": \"AccountRoot\",\r\n      \"LedgerIndex\": \"72A59CDF8FFBF65C20D01D3A3D5DA5BAE3158A3881E7AEE525A01B1CC73D32DD\",\r\n      \"PreviousFields\": {\r\n        \"Balance\": \"6060125325\",\r\n        \"Sequence\": 4740\r\n      },\r\n      \"PreviousTxnID\": \"58950678AE345C974070D196D73F2244C5F8E90AF7C864D30087AE8F2560E697\",\r\n      \"PreviousTxnLgrSeq\": 30754511\r\n    }\r\n  }, {\r\n    \"CreatedNode\": {\r\n      \"LedgerEntryType\": \"DirectoryNode\",\r\n      \"LedgerIndex\": \"7E984AD10069041B9B957C73D05AF2AB3D117C0CCAF7FDA5500AC40B67AED936\",\r\n      \"NewFields\": {\r\n        \"ExchangeRate\": \"500AC40B67AED936\",\r\n        \"RootIndex\": \"7E984AD10069041B9B957C73D05AF2AB3D117C0CCAF7FDA5500AC40B67AED936\",\r\n        \"TakerGetsCurrency\": \"0000000000000000000000004A50590000000000\",\r\n        \"TakerGetsIssuer\": \"6F2531F2B8CDB96D6D986D9D75CC0156DF2C5387\",\r\n        \"TakerPaysCurrency\": \"000000000000000000000000524A500000000000\",\r\n        \"TakerPaysIssuer\": \"6F2531F2B8CDB96D6D986D9D75CC0156DF2C5387\"\r\n      }\r\n    }\r\n  }, {\r\n    \"ModifiedNode\": {\r\n      \"FinalFields\": {\r\n        \"Flags\": 0,\r\n        \"IndexPrevious\": \"0000000000000006\",\r\n        \"Owner\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\r\n        \"RootIndex\": \"C5383B94DDE4BE2A184757D80837080C4D1EAB80789FE39F7D7AECFB0D0304BB\"\r\n      },\r\n      \"LedgerEntryType\": \"DirectoryNode\",\r\n      \"LedgerIndex\": \"91565E4F1A8282718C8D6ED8EFEE2B5DC18101FC76D0AE436F46194F4567EF5E\"\r\n    }\r\n  }, {\r\n    \"DeletedNode\": {\r\n      \"FinalFields\": {\r\n        \"ExchangeRate\": \"590B6C0684F3F000\",\r\n        \"Flags\": 0,\r\n        \"RootIndex\": \"DCAAC0CDAC8DA851AC8E225CA9ED9305CB4BBE7E4E255AB3590B6C0684F3F000\",\r\n        \"TakerGetsCurrency\": \"000000000000000000000000524A500000000000\",\r\n        \"TakerGetsIssuer\": \"6F2531F2B8CDB96D6D986D9D75CC0156DF2C5387\",\r\n        \"TakerPaysCurrency\": \"0000000000000000000000004A50590000000000\",\r\n        \"TakerPaysIssuer\": \"6F2531F2B8CDB96D6D986D9D75CC0156DF2C5387\"\r\n      },\r\n      \"LedgerEntryType\": \"DirectoryNode\",\r\n      \"LedgerIndex\": \"DCAAC0CDAC8DA851AC8E225CA9ED9305CB4BBE7E4E255AB3590B6C0684F3F000\"\r\n    }\r\n  }, {\r\n    \"DeletedNode\": {\r\n      \"FinalFields\": {\r\n        \"Account\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\r\n        \"BookDirectory\": \"DCAAC0CDAC8DA851AC8E225CA9ED9305CB4BBE7E4E255AB3590B6C0684F3F000\",\r\n        \"BookNode\": \"0000000000000000\",\r\n        \"Flags\": 131072,\r\n        \"OwnerNode\": \"000000000000000F\",\r\n        \"PreviousTxnID\": \"58950678AE345C974070D196D73F2244C5F8E90AF7C864D30087AE8F2560E697\",\r\n        \"PreviousTxnLgrSeq\": 30754511,\r\n        \"Sequence\": 4739,\r\n        \"TakerGets\": {\r\n          \"currency\": \"RJP\",\r\n          \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n          \"value\": \"6642980000000000e-26\"\r\n        },\r\n        \"TakerPays\": {\r\n          \"currency\": \"JPY\",\r\n          \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n          \"value\": \"0.000002135718\"\r\n        }\r\n      },\r\n      \"LedgerEntryType\": \"Offer\",\r\n      \"LedgerIndex\": \"FAE681F5F36A40EC2CB4C47AF50EBCFE646EC786B52C5003E7EC7469BC255475\"\r\n    }\r\n  }],\r\n  \"TransactionIndex\": 87,\r\n  \"TransactionResult\": \"tesSUCCESS\"\r\n}";

	String error_simple = "{\r\n  \"AffectedNodes\": [{\r\n    \"DeletedNode\": {\r\n      \"FinalFields\": {\r\n        \"Account\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\r\n        \"BookDirectory\": \"DCAAC0CDAC8DA851AC8E225CA9ED9305CB4BBE7E4E255AB3590B6C0684F3F000\",\r\n        \"BookNode\": \"0000000000000000\",\r\n        \"Flags\": 131072,\r\n        \"OwnerNode\": \"000000000000000F\",\r\n        \"PreviousTxnID\": \"58950678AE345C974070D196D73F2244C5F8E90AF7C864D30087AE8F2560E697\",\r\n        \"PreviousTxnLgrSeq\": 30754511,\r\n        \"Sequence\": 4739,\r\n        \"TakerGets\": {\r\n          \"currency\": \"RJP\",\r\n          \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n          \"value\": \"6642980000000000e-26\"\r\n        },\r\n        \"TakerPays\": {\r\n          \"currency\": \"JPY\",\r\n          \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n          \"value\": \"0.000002135718\"\r\n        }\r\n      },\r\n      \"LedgerEntryType\": \"Offer\",\r\n      \"LedgerIndex\": \"FAE681F5F36A40EC2CB4C47AF50EBCFE646EC786B52C5003E7EC7469BC255475\"\r\n    }\r\n  }],\r\n  \"TransactionIndex\": 87,\r\n  \"TransactionResult\": \"tesSUCCESS\"\r\n}";
	String s2 = "{   \"AffectedNodes\":[{\"ModifiedNode\": {\"FinalFields\": "
			+ "{\"Balance\": {\"currency\": \"JPY\",\"issuer\": \"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\": \"7759.042930849417\"},"
			+ "\"Flags\": 1114112, "
			+ "\"HighLimit\": {\"currency\": \"JPY\",\"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\", \"value\": \"0\"  },"
			+ "\"HighNode\": \"0000000000000399\",  \"LowLimit\": { \"currency\": \"JPY\",\"issuer\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\","
			+ "          \"value\": \"100000\"         },         \"LowNode\": \"0000000000000001\"       },       \"LedgerEntryType\": \"RippleState\",       \"LedgerIndex\": \"21110D01A36A7EB20188B11D685B847322DE631145C31803E1760550FA399BAD\",       \"PreviousFields\": {         \"Balance\": {           \"currency\": \"JPY\",           \"issuer\": \"rrrrrrrrrrrrrrrrrrrrBZbvji\",           \"value\": \"7726.207390435917\"         }       },       \"PreviousTxnID\": \"E48BEC5D47AE944154348B4F62230489CC1A29A4A1E5A04D3F95C5B77C9E58DC\",       \"PreviousTxnLgrSeq\": 30751697     }   }, {     \"ModifiedNode\": {       \"FinalFields\": {         \"Balance\": {           \"currency\": \"RJP\",           \"issuer\": \"rrrrrrrrrrrrrrrrrrrrBZbvji\",           \"value\": \"4.976421472710849\"         },         \"Flags\": 1114112,         \"HighLimit\": {           \"currency\": \"RJP\",           \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",           \"value\": \"0\"         },         \"HighNode\": \"00000000000003FB\",         \"LowLimit\": {           \"currency\": \"RJP\",           \"issuer\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",           \"value\": \"10000\"         },         \"LowNode\": \"0000000000000006\",         \"LowQualityIn\": 1000000000       },       \"LedgerEntryType\": \"RippleState\",       \"LedgerIndex\": \"4A8FE98984B510E3F0223CB8C9110FA370EC545BCD6CE6863C8405E5BC360423\",       \"PreviousFields\": {         \"Balance\": {           \"currency\": \"RJP\",           \"issuer\": \"rrrrrrrrrrrrrrrrrrrrBZbvji\",           \"value\": \"4.977423472710849\"         }       },       \"PreviousTxnID\": \"E48BEC5D47AE944154348B4F62230489CC1A29A4A1E5A04D3F95C5B77C9E58DC\",       \"PreviousTxnLgrSeq\": 30751697     }   }, {     \"ModifiedNode\": {       \"FinalFields\": {         \"Account\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",         \"Balance\": \"6053125421\",         \"Flags\": 0,         \"OwnerCount\": 9,         \"Sequence\": 4732       },       \"LedgerEntryType\": \"AccountRoot\",       \"LedgerIndex\": \"72A59CDF8FFBF65C20D01D3A3D5DA5BAE3158A3881E7AEE525A01B1CC73D32DD\",       \"PreviousFields\": {         \"Balance\": \"6053125433\",         \"Sequence\": 4731       },       \"PreviousTxnID\": \"BF6D71232F6FF46AE46EB47FBA08FBE8BDF60ECDFB44E7EE3DDEBF6B03FE39DF\",       \"PreviousTxnLgrSeq\": 30751741     }   }, {     \"ModifiedNode\": {       \"FinalFields\": {         \"Account\": \"rwDM6HHJvF5xFLb9mScvuMbcMJh1RYrHTW\",         \"Balance\": \"27686759695\",         \"Flags\": 0,         \"OwnerCount\": 6,         \"Sequence\": 3877       },       \"LedgerEntryType\": \"AccountRoot\",       \"LedgerIndex\": \"7BCD3E1B7B8DEC6A14048318C45E0E6C90D9CC81C30CF74AF5F0A2AC9E75C7D5\",       \"PreviousFields\": {         \"Balance\": \"27685728768\"       },       \"PreviousTxnID\": \"20305F3439B83F48BDA0FB7AEE3EAD2F02799ED58B109EB0A6F24ACBD4BF694C\",       \"PreviousTxnLgrSeq\": 30751741     }   }, {     \"ModifiedNode\": {       \"FinalFields\": {         \"Account\": \"rLjDNH9g1AajRT2pxALZmwesd64p4x9XZJ\",         \"Balance\": \"1850436988555\",         \"Flags\": 0,         \"OwnerCount\": 997,         \"Sequence\": 195798       },       \"LedgerEntryType\": \"AccountRoot\",       \"LedgerIndex\": \"7F28475BBAE8E0654C4D4C876DFBF7A3C40DEFEB6DF2F4C301F7F7F3514F255F\",       \"PreviousFields\": {         \"Balance\": \"1850438019482\"       },       \"PreviousTxnID\": \"007B1305C24FABEE23AECD678E2959AE44D0528C5676BEDA266B19368C0B1592\",       \"PreviousTxnLgrSeq\": 30751698     }   }, {     \"ModifiedNode\": {       \"FinalFields\": {         \"Account\": \"rLjDNH9g1AajRT2pxALZmwesd64p4x9XZJ\",         \"BookDirectory\": \"59E6C90874EE6DE9C3187C89BE98BA49ADFCD5411C40488A4B2276193EFD2C77\",         \"BookNode\": \"0000000000000000\",         \"Flags\": 131072,         \"OwnerNode\": \"0000000000000CD3\",         \"Sequence\": 192286,         \"TakerGets\": \"584361423\",         \"TakerPays\": {           \"currency\": \"RJP\",           \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",           \"value\": \"0.5668305784604696\"         }       },       \"LedgerEntryType\": \"Offer\",       \"LedgerIndex\": \"812C568F465DA8A7BDBDBF424F0D304C9A1ABD80B0E638F20F19DE6E60A9A119\",       \"PreviousFields\": {         \"TakerGets\": \"585392350\",         \"TakerPays\": {           \"currency\": \"RJP\",           \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",           \"value\": \"0.5678305784604696\"         }       },       \"PreviousTxnID\": \"E48BEC5D47AE944154348B4F62230489CC1A29A4A1E5A04D3F95C5B77C9E58DC\",       \"PreviousTxnLgrSeq\": 30751697     }   }, {     \"ModifiedNode\": {       \"FinalFields\": {         \"Balance\": {           \"currency\": \"JPY\",           \"issuer\": \"rrrrrrrrrrrrrrrrrrrrBZbvji\",           \"value\": \"1953293.596041137\"         },         \"Flags\": 1114112,         \"HighLimit\": {           \"currency\": \"JPY\",           \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",           \"value\": \"0\"         },         \"HighNode\": \"00000000000001FE\",         \"LowLimit\": {           \"currency\": \"JPY\",           \"issuer\": \"rwDM6HHJvF5xFLb9mScvuMbcMJh1RYrHTW\",           \"value\": \"10000000000\"         },         \"LowNode\": \"0000000000000000\"       },       \"LedgerEntryType\": \"RippleState\",       \"LedgerIndex\": \"95DD2AD0A0595AF913AF1723FB32C7EC424481B9067AAC588A4B19FAE9117414\",       \"PreviousFields\": {         \"Balance\": {           \"currency\": \"JPY\",           \"issuer\": \"rrrrrrrrrrrrrrrrrrrrBZbvji\",           \"value\": \"1953326.497252631\"         }       },       \"PreviousTxnID\": \"20305F3439B83F48BDA0FB7AEE3EAD2F02799ED58B109EB0A6F24ACBD4BF694C\",       \"PreviousTxnLgrSeq\": 30751741     }   }, {     \"ModifiedNode\": {       \"FinalFields\": {         \"Account\": \"rwDM6HHJvF5xFLb9mScvuMbcMJh1RYrHTW\",         \"BookDirectory\": \"A7A2258942BF79A1C2A55DA88560879DC312966AFDD1CD05590B2782F405EC97\",         \"BookNode\": \"0000000000000000\",         \"Flags\": 0,         \"OwnerNode\": \"0000000000000000\",         \"Sequence\": 3875,         \"TakerGets\": {           \"currency\": \"JPY\",           \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",           \"value\": \"113152.4081650767\"         },         \"TakerPays\": \"3552610108\"       },       \"LedgerEntryType\": \"Offer\",       \"LedgerIndex\": \"DAB88E50BB04FC251ACE4FAA4C0D43914B0A993E2578D49D39FD3EA4786BD45D\",       \"PreviousFields\": {         \"TakerGets\": {           \"currency\": \"JPY\",           \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",           \"value\": \"113185.2437054902\"         },         \"TakerPays\": \"3553641035\"       },       \"PreviousTxnID\": \"20305F3439B83F48BDA0FB7AEE3EAD2F02799ED58B109EB0A6F24ACBD4BF694C\",       \"PreviousTxnLgrSeq\": 30751741     }   }, {     \"ModifiedNode\": {       \"FinalFields\": {         \"Balance\": {           \"currency\": \"RJP\",           \"issuer\": \"rrrrrrrrrrrrrrrrrrrrBZbvji\",           \"value\": \"-258.1424888831164\"         },         \"Flags\": 2228224,         \"HighLimit\": {           \"currency\": \"RJP\",           \"issuer\": \"rLjDNH9g1AajRT2pxALZmwesd64p4x9XZJ\",           \"value\": \"10000000000\"         },         \"HighNode\": \"0000000000000009\",         \"LowLimit\": {           \"currency\": \"RJP\",           \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",           \"value\": \"0\"         },         \"LowNode\": \"0000000000000012\"       },       \"LedgerEntryType\": \"RippleState\",       \"LedgerIndex\": \"FAE9C113C6BAFF7BAD167E5D3B88F4DA967EC1E33FBB48CC0611B7E050FFA231\",       \"PreviousFields\": {         \"Balance\": {           \"currency\": \"RJP\",           \"issuer\": \"rrrrrrrrrrrrrrrrrrrrBZbvji\",           \"value\": \"-258.1414888831164\"         }       },       \"PreviousTxnID\": \"E48BEC5D47AE944154348B4F62230489CC1A29A4A1E5A04D3F95C5B77C9E58DC\",       \"PreviousTxnLgrSeq\": 30751697     }   }],   \"TransactionIndex\": 0,   \"TransactionResult\": \"tesSUCCESS\" }";
	String errorFix1 = "{\r\n  \"AffectedNodes\": [{\r\n    \"DeletedNode\": {\r\n      \"FinalFields\": {\r\n        \"Account\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\r\n        \"BookDirectory\": \"DCAAC0CDAC8DA851AC8E225CA9ED9305CB4BBE7E4E255AB3590B6C0684F3F000\",\r\n        \"BookNode\": \"0000000000000000\",\r\n        \"Flags\": 131072,\r\n        \"OwnerNode\": \"000000000000000F\",\r\n        \"PreviousTxnID\": \"58950678AE345C974070D196D73F2244C5F8E90AF7C864D30087AE8F2560E697\",\r\n        \"PreviousTxnLgrSeq\": 30754511,\r\n        \"Sequence\": 4739,\r\n        \"TakerGets\": {\r\n          \"currency\": \"RJP\",\r\n          \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n          \"value\": \"6642980000000000e-26\"\r\n        },\r\n        \"TakerPays\": {\r\n          \"currency\": \"JPY\",\r\n          \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n          \"value\": \"0.000002135718\"\r\n        }\r\n      },\r\n      \"LedgerEntryType\": \"Offer\",\r\n      \"LedgerIndex\": \"FAE681F5F36A40EC2CB4C47AF50EBCFE646EC786B52C5003E7EC7469BC255475\",\r\n      \"PreviousFields\": {\r\n        \"TakerGets\": {\r\n          \"currency\": \"RJP\",\r\n          \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n          \"value\": \"0.0000000008425116\"\r\n        },\r\n        \"TakerPays\": {\r\n          \"currency\": \"JPY\",\r\n          \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n          \"value\": \"0.000027057258\"\r\n        }\r\n      }\r\n    }\r\n  }],\r\n  \"TransactionIndex\": 87,\r\n  \"TransactionResult\": \"tesSUCCESS\"\r\n}";

	String s3 = " {\r\n   \"AffectedNodes\": [{\r\n     \"ModifiedNode\": {\r\n       \"FinalFields\": {\r\n         \"Balance\": {\r\n           \"currency\": \"JPY\",\r\n           \"issuer\": \"rrrrrrrrrrrrrrrrrrrrBZbvji\",\r\n           \"value\": \"9961.390726256115\"\r\n         },\r\n         \"Flags\": 1114112,\r\n         \"HighLimit\": {\r\n           \"currency\": \"JPY\",\r\n           \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n           \"value\": \"0\"\r\n         },\r\n         \"HighNode\": \"0000000000000399\",\r\n         \"LowLimit\": {\r\n           \"currency\": \"JPY\",\r\n           \"issuer\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\r\n           \"value\": \"100000\"\r\n         },\r\n         \"LowNode\": \"0000000000000001\"\r\n       },\r\n       \"LedgerEntryType\": \"RippleState\",\r\n       \"LedgerIndex\": \"21110D01A36A7EB20188B11D685B847322DE631145C31803E1760550FA399BAD\",\r\n       \"PreviousFields\": {\r\n         \"Balance\": {\r\n           \"currency\": \"JPY\",\r\n           \"issuer\": \"rrrrrrrrrrrrrrrrrrrrBZbvji\",\r\n           \"value\": \"9992.953726256115\"\r\n         }\r\n       },\r\n       \"PreviousTxnID\": \"57B40459FD9C979828C95CA120AE56CB2253E6357ED6B2E42E5F14E1CA64B0C4\",\r\n       \"PreviousTxnLgrSeq\": 30754970\r\n     }\r\n   }, {\r\n     \"ModifiedNode\": {\r\n       \"FinalFields\": {\r\n         \"Balance\": {\r\n           \"currency\": \"JPY\",\r\n           \"issuer\": \"rrrrrrrrrrrrrrrrrrrrBZbvji\",\r\n           \"value\": \"1223655.696197359\"\r\n         },\r\n         \"Flags\": 1114112,\r\n         \"HighLimit\": {\r\n           \"currency\": \"JPY\",\r\n           \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n           \"value\": \"0\"\r\n         },\r\n         \"HighNode\": \"0000000000000401\",\r\n         \"LowLimit\": {\r\n           \"currency\": \"JPY\",\r\n           \"issuer\": \"rwe13Fyyra13g2w3yY6R8zCbHhoN54aHwN\",\r\n           \"value\": \"0\"\r\n         },\r\n         \"LowNode\": \"0000000000000000\"\r\n       },\r\n       \"LedgerEntryType\": \"RippleState\",\r\n       \"LedgerIndex\": \"41323D49CF725CE9D75773687E869EF37DDDBEDCDF3AEB71FE0923CF8288D5E3\",\r\n       \"PreviousFields\": {\r\n         \"Balance\": {\r\n           \"currency\": \"JPY\",\r\n           \"issuer\": \"rrrrrrrrrrrrrrrrrrrrBZbvji\",\r\n           \"value\": \"1223624.196197359\"\r\n         }\r\n       },\r\n       \"PreviousTxnID\": \"CC3826BF3F9E42963337918BD994C7DF3792BA8C23E902BB83348235E4AE041C\",\r\n       \"PreviousTxnLgrSeq\": 30756941\r\n     }\r\n   }, {\r\n     \"ModifiedNode\": {\r\n       \"FinalFields\": {\r\n         \"Account\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\r\n         \"Balance\": \"6061125277\",\r\n         \"Flags\": 0,\r\n         \"OwnerCount\": 9,\r\n         \"Sequence\": 4744\r\n       },\r\n       \"LedgerEntryType\": \"AccountRoot\",\r\n       \"LedgerIndex\": \"72A59CDF8FFBF65C20D01D3A3D5DA5BAE3158A3881E7AEE525A01B1CC73D32DD\",\r\n       \"PreviousFields\": {\r\n         \"Balance\": \"6060125289\",\r\n         \"Sequence\": 4743\r\n       },\r\n       \"PreviousTxnID\": \"EF7BF9F523E74777027EE4765F542532FF89B6E1132685D6E75C4AFFF072151C\",\r\n       \"PreviousTxnLgrSeq\": 30756249\r\n     }\r\n   }, {\r\n     \"ModifiedNode\": {\r\n       \"FinalFields\": {\r\n         \"Account\": \"rwe13Fyyra13g2w3yY6R8zCbHhoN54aHwN\",\r\n         \"Balance\": \"78055106082\",\r\n         \"Flags\": 0,\r\n         \"OwnerCount\": 153,\r\n         \"Sequence\": 2992\r\n       },\r\n       \"LedgerEntryType\": \"AccountRoot\",\r\n       \"LedgerIndex\": \"A138BD11AB4888081FE554868C4AD5C68668038EAA7292C7D5034D52E14508C3\",\r\n       \"PreviousFields\": {\r\n         \"Balance\": \"78056106082\"\r\n       },\r\n       \"PreviousTxnID\": \"CC3826BF3F9E42963337918BD994C7DF3792BA8C23E902BB83348235E4AE041C\",\r\n       \"PreviousTxnLgrSeq\": 30756941\r\n     }\r\n   }, {\r\n     \"ModifiedNode\": {\r\n       \"FinalFields\": {\r\n         \"Account\": \"rwe13Fyyra13g2w3yY6R8zCbHhoN54aHwN\",\r\n         \"BookDirectory\": \"11EEBF7DFC0076D299322039F1493C921CAAEFE85B322E5D500B30E8870AE000\",\r\n         \"BookNode\": \"0000000000000000\",\r\n         \"Flags\": 131072,\r\n         \"OwnerNode\": \"0000000000000038\",\r\n         \"Sequence\": 2988,\r\n         \"TakerGets\": \"1102314630\",\r\n         \"TakerPays\": {\r\n           \"currency\": \"JPY\",\r\n           \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n           \"value\": \"34722.91084001709\"\r\n         }\r\n       },\r\n       \"LedgerEntryType\": \"Offer\",\r\n       \"LedgerIndex\": \"A98B392BCBD03A4C7F4C8574B13669881BA8E05847DC5622A1531ACE8EBF185F\",\r\n       \"PreviousFields\": {\r\n         \"TakerGets\": \"1103314630\",\r\n         \"TakerPays\": {\r\n           \"currency\": \"JPY\",\r\n           \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n           \"value\": \"34754.41084001709\"\r\n         }\r\n       },\r\n       \"PreviousTxnID\": \"CC3826BF3F9E42963337918BD994C7DF3792BA8C23E902BB83348235E4AE041C\",\r\n       \"PreviousTxnLgrSeq\": 30756941\r\n     }\r\n   }],\r\n   \"TransactionIndex\": 2,\r\n   \"TransactionResult\": \"tesSUCCESS\"\r\n }";

	String unrelatedS = "{\r\n  \"AffectedNodes\": [{\r\n      \"ModifiedNode\": {\r\n        \"FinalFields\": {\r\n          \"Balance\": {\r\n            \"currency\": \"JPY\",\r\n            \"issuer\": \"rrrrrrrrrrrrrrrrrrrrBZbvji\",\r\n            \"value\": \"9999.86990579025\"\r\n          },\r\n          \"Flags\": 1114112,\r\n          \"HighLimit\": {\r\n            \"currency\": \"JPY\",\r\n            \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n            \"value\": \"0\"\r\n          },\r\n          \"HighNode\": \"0000000000000399\",\r\n          \"LowLimit\": {\r\n            \"currency\": \"JPY\",\r\n            \"issuer\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\r\n            \"value\": \"100000\"\r\n          },\r\n          \"LowNode\": \"0000000000000001\"\r\n        },\r\n        \"LedgerEntryType\": \"RippleState\",\r\n        \"LedgerIndex\": \"21110D01A36A7EB20188B11D685B847322DE631145C31803E1760550FA399BAD\",\r\n        \"PreviousFields\": {\r\n          \"Balance\": {\r\n            \"currency\": \"JPY\",\r\n            \"issuer\": \"rrrrrrrrrrrrrrrrrrrrBZbvji\",\r\n            \"value\": \"13299.53989389704\"\r\n          }\r\n        },\r\n        \"PreviousTxnID\": \"58950678AE345C974070D196D73F2244C5F8E90AF7C864D30087AE8F2560E697\",\r\n        \"PreviousTxnLgrSeq\": 30754511\r\n      }\r\n    },\r\n    {\r\n      \"ModifiedNode\": {\r\n        \"LedgerEntryType\": \"AccountRoot\",\r\n        \"LedgerIndex\": \"2C6F7594FB7471F4983C2BC691AAC2F25F8DB88D455985B4181E053D7AB23006\",\r\n        \"PreviousTxnID\": \"5C8B4473A490DDC4DBD8591E292017C52A189E06245B45E8CD067EB4B806CCD5\",\r\n        \"PreviousTxnLgrSeq\": 30754741\r\n      }\r\n    },\r\n    {\r\n      \"ModifiedNode\": {\r\n        \"FinalFields\": {\r\n          \"Balance\": {\r\n            \"currency\": \"RJP\",\r\n            \"issuer\": \"rrrrrrrrrrrrrrrrrrrrBZbvji\",\r\n            \"value\": \"4.895811891579408\"\r\n          },\r\n          \"Flags\": 1114112,\r\n          \"HighLimit\": {\r\n            \"currency\": \"RJP\",\r\n            \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n            \"value\": \"0\"\r\n          },\r\n          \"HighNode\": \"00000000000003FB\",\r\n          \"LowLimit\": {\r\n            \"currency\": \"RJP\",\r\n            \"issuer\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\r\n            \"value\": \"10000\"\r\n          },\r\n          \"LowNode\": \"0000000000000006\",\r\n          \"LowQualityIn\": 1000000000\r\n        },\r\n        \"LedgerEntryType\": \"RippleState\",\r\n        \"LedgerIndex\": \"4A8FE98984B510E3F0223CB8C9110FA370EC545BCD6CE6863C8405E5BC360423\",\r\n        \"PreviousFields\": {\r\n          \"Balance\": {\r\n            \"currency\": \"RJP\",\r\n            \"issuer\": \"rrrrrrrrrrrrrrrrrrrrBZbvji\",\r\n            \"value\": \"4.796021472777413\"\r\n          }\r\n        },\r\n        \"PreviousTxnID\": \"58950678AE345C974070D196D73F2244C5F8E90AF7C864D30087AE8F2560E697\",\r\n        \"PreviousTxnLgrSeq\": 30754511\r\n      }\r\n    },\r\n    {\r\n      \"ModifiedNode\": {\r\n        \"FinalFields\": {\r\n          \"Flags\": 0,\r\n          \"Owner\": \"rBZ6C6PTTscDUfGiSSdtdRK5ZzSRLuyqtM\",\r\n          \"RootIndex\": \"54D6C77DF6EEB068423BFC12CB8E9DBA3B7A3967782A57BC11CE19FB225FC971\"\r\n        },\r\n        \"LedgerEntryType\": \"DirectoryNode\",\r\n        \"LedgerIndex\": \"54D6C77DF6EEB068423BFC12CB8E9DBA3B7A3967782A57BC11CE19FB225FC971\"\r\n      }\r\n    },\r\n    {\r\n      \"ModifiedNode\": {\r\n        \"FinalFields\": {\r\n          \"Account\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\r\n          \"BookDirectory\": \"7E984AD10069041B9B957C73D05AF2AB3D117C0CCAF7FDA5500AC40B67AED936\",\r\n          \"BookNode\": \"0000000000000000\",\r\n          \"Flags\": 0,\r\n          \"OwnerNode\": \"000000000000000F\",\r\n          \"Sequence\": 4740,\r\n          \"TakerGets\": {\r\n            \"currency\": \"JPY\",\r\n            \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n            \"value\": \"6.916179534135\"\r\n          },\r\n          \"TakerPays\": {\r\n            \"currency\": \"RJP\",\r\n            \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n            \"value\": \"0.0002095811980041\"\r\n          }\r\n        },\r\n        \"LedgerEntryType\": \"Offer\",\r\n        \"LedgerIndex\": \"60B13F57D2B799D2C05EFB11C7C032D35D9320738AB07C6BDDAC3C10BBCFDFF1\",\r\n        \"PreviousFields\": {\r\n          \"TakerGets\": {\r\n            \"currency\": \"JPY\",\r\n            \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n            \"value\": \"3300\"\r\n          },\r\n          \"TakerPays\": {\r\n            \"currency\": \"RJP\",\r\n            \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n            \"value\": \"0.1\"\r\n          }\r\n        },\r\n        \"PreviousTxnID\": \"9A5A9ECA97CD3F3E028F3BC663E336F7643A4A58749AD2A63D4399EE37175C1D\",\r\n        \"PreviousTxnLgrSeq\": 30754741\r\n      }\r\n    },\r\n    {\r\n      \"DeletedNode\": {\r\n        \"FinalFields\": {\r\n          \"Balance\": {\r\n            \"currency\": \"RJP\",\r\n            \"issuer\": \"rrrrrrrrrrrrrrrrrrrrBZbvji\",\r\n            \"value\": \"0\"\r\n          },\r\n          \"Flags\": 2097152,\r\n          \"HighLimit\": {\r\n            \"currency\": \"RJP\",\r\n            \"issuer\": \"rBZ6C6PTTscDUfGiSSdtdRK5ZzSRLuyqtM\",\r\n            \"value\": \"0\"\r\n          },\r\n          \"HighNode\": \"0000000000000000\",\r\n          \"LowLimit\": {\r\n            \"currency\": \"RJP\",\r\n            \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n            \"value\": \"0\"\r\n          },\r\n          \"LowNode\": \"0000000000000434\",\r\n          \"PreviousTxnID\": \"5C8B4473A490DDC4DBD8591E292017C52A189E06245B45E8CD067EB4B806CCD5\",\r\n          \"PreviousTxnLgrSeq\": 30754741\r\n        },\r\n        \"LedgerEntryType\": \"RippleState\",\r\n        \"LedgerIndex\": \"665EC98C3199CEFF20FCC18FBF38DB27313992F6BC574274D7873E8E30F114B2\",\r\n        \"PreviousFields\": {\r\n          \"Balance\": {\r\n            \"currency\": \"RJP\",\r\n            \"issuer\": \"rrrrrrrrrrrrrrrrrrrrBZbvji\",\r\n            \"value\": \"-0.09998999963959992\"\r\n          },\r\n          \"Flags\": 2228224\r\n        }\r\n      }\r\n    },\r\n    {\r\n      \"ModifiedNode\": {\r\n        \"FinalFields\": {\r\n          \"Balance\": {\r\n            \"currency\": \"JPY\",\r\n            \"issuer\": \"rrrrrrrrrrrrrrrrrrrrBZbvji\",\r\n            \"value\": \"-6491.730819749973\"\r\n          },\r\n          \"Flags\": 2228224,\r\n          \"HighLimit\": {\r\n            \"currency\": \"JPY\",\r\n            \"issuer\": \"rBZ6C6PTTscDUfGiSSdtdRK5ZzSRLuyqtM\",\r\n            \"value\": \"0\"\r\n          },\r\n          \"HighNode\": \"0000000000000000\",\r\n          \"LowLimit\": {\r\n            \"currency\": \"JPY\",\r\n            \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n            \"value\": \"0\"\r\n          },\r\n          \"LowNode\": \"0000000000000434\"\r\n        },\r\n        \"LedgerEntryType\": \"RippleState\",\r\n        \"LedgerIndex\": \"A0CCE73BAF703B69E1DA2069A0CA67F4A7C3969637BDA5A0B6AB365CC8AC980C\",\r\n        \"PreviousFields\": {\r\n          \"Balance\": {\r\n            \"currency\": \"JPY\",\r\n            \"issuer\": \"rrrrrrrrrrrrrrrrrrrrBZbvji\",\r\n            \"value\": \"-3198.646999284108\"\r\n          }\r\n        },\r\n        \"PreviousTxnID\": \"58950678AE345C974070D196D73F2244C5F8E90AF7C864D30087AE8F2560E697\",\r\n        \"PreviousTxnLgrSeq\": 30754511\r\n      }\r\n    },\r\n    {\r\n      \"ModifiedNode\": {\r\n        \"FinalFields\": {\r\n          \"Account\": \"rBZ6C6PTTscDUfGiSSdtdRK5ZzSRLuyqtM\",\r\n          \"Balance\": \"90824407560\",\r\n          \"Flags\": 0,\r\n          \"OwnerCount\": 2,\r\n          \"Sequence\": 794981\r\n        },\r\n        \"LedgerEntryType\": \"AccountRoot\",\r\n        \"LedgerIndex\": \"B5F67997908717D6490528D1CDD10584C960082FD19269928FD96F5492CE8F35\",\r\n        \"PreviousFields\": {\r\n          \"Balance\": \"90824420560\",\r\n          \"OwnerCount\": 3,\r\n          \"Sequence\": 794980\r\n        },\r\n        \"PreviousTxnID\": \"5C8B4473A490DDC4DBD8591E292017C52A189E06245B45E8CD067EB4B806CCD5\",\r\n        \"PreviousTxnLgrSeq\": 30754741\r\n      }\r\n    },\r\n    {\r\n      \"ModifiedNode\": {\r\n        \"FinalFields\": {\r\n          \"Flags\": 0,\r\n          \"IndexPrevious\": \"0000000000000433\",\r\n          \"Owner\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n          \"RootIndex\": \"5E57FEC97EA6A8F8CB9EAF25669F7B8BCEC18B95A38D28CBAC9CFB78657C9F96\"\r\n        },\r\n        \"LedgerEntryType\": \"DirectoryNode\",\r\n        \"LedgerIndex\": \"F50448144CCF1764BD0E3D0CD0793596A6D1510B62A07C1EA6658500000D0D83\"\r\n      }\r\n    }\r\n  ],\r\n  \"TransactionIndex\": 90,\r\n  \"TransactionResult\": \"tesSUCCESS\"\r\n}";

	String unrelatedS2 = "  {\r\n    \"AffectedNodes\": [{\r\n        \"ModifiedNode\": {\r\n          \"FinalFields\": {\r\n            \"Account\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\r\n            \"Balance\": \"6060125289\",\r\n            \"Flags\": 0,\r\n            \"OwnerCount\": 9,\r\n            \"Sequence\": 4743\r\n          },\r\n          \"LedgerEntryType\": \"AccountRoot\",\r\n          \"LedgerIndex\": \"72A59CDF8FFBF65C20D01D3A3D5DA5BAE3158A3881E7AEE525A01B1CC73D32DD\",\r\n          \"PreviousFields\": {\r\n            \"Balance\": \"6060125301\",\r\n            \"OwnerCount\": 10,\r\n            \"Sequence\": 4742\r\n          },\r\n          \"PreviousTxnID\": \"503DD0C7597051A4592E8DABC2BA4AA286231FFE3A30AB855D9A569CCB887132\",\r\n          \"PreviousTxnLgrSeq\": 30756200\r\n        }\r\n      },\r\n      {\r\n        \"DeletedNode\": {\r\n          \"FinalFields\": {\r\n            \"Account\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\r\n            \"BookDirectory\": \"DCAAC0CDAC8DA851AC8E225CA9ED9305CB4BBE7E4E255AB3590BACC80FA93000\",\r\n            \"BookNode\": \"0000000000000000\",\r\n            \"Flags\": 131072,\r\n            \"OwnerNode\": \"000000000000000F\",\r\n            \"PreviousTxnID\": \"503DD0C7597051A4592E8DABC2BA4AA286231FFE3A30AB855D9A569CCB887132\",\r\n            \"PreviousTxnLgrSeq\": 30756200,\r\n            \"Sequence\": 4741,\r\n            \"TakerGets\": {\r\n              \"currency\": \"RJP\",\r\n              \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n              \"value\": \"0.1\"\r\n            },\r\n            \"TakerPays\": {\r\n              \"currency\": \"JPY\",\r\n              \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n              \"value\": \"3286.2\"\r\n            }\r\n          },\r\n          \"LedgerEntryType\": \"Offer\",\r\n          \"LedgerIndex\": \"76BEC8D4790AC90F0C9FCECFCBE9DC6969AD2866114362AE4AA2B0382F785B29\"\r\n        }\r\n      },\r\n      {\r\n        \"ModifiedNode\": {\r\n          \"FinalFields\": {\r\n            \"Flags\": 0,\r\n            \"IndexPrevious\": \"0000000000000006\",\r\n            \"Owner\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\r\n            \"RootIndex\": \"C5383B94DDE4BE2A184757D80837080C4D1EAB80789FE39F7D7AECFB0D0304BB\"\r\n          },\r\n          \"LedgerEntryType\": \"DirectoryNode\",\r\n          \"LedgerIndex\": \"91565E4F1A8282718C8D6ED8EFEE2B5DC18101FC76D0AE436F46194F4567EF5E\"\r\n        }\r\n      },\r\n      {\r\n        \"DeletedNode\": {\r\n          \"FinalFields\": {\r\n            \"ExchangeRate\": \"590BACC80FA93000\",\r\n            \"Flags\": 0,\r\n            \"RootIndex\": \"DCAAC0CDAC8DA851AC8E225CA9ED9305CB4BBE7E4E255AB3590BACC80FA93000\",\r\n            \"TakerGetsCurrency\": \"000000000000000000000000524A500000000000\",\r\n            \"TakerGetsIssuer\": \"6F2531F2B8CDB96D6D986D9D75CC0156DF2C5387\",\r\n            \"TakerPaysCurrency\": \"0000000000000000000000004A50590000000000\",\r\n            \"TakerPaysIssuer\": \"6F2531F2B8CDB96D6D986D9D75CC0156DF2C5387\"\r\n          },\r\n          \"LedgerEntryType\": \"DirectoryNode\",\r\n          \"LedgerIndex\": \"DCAAC0CDAC8DA851AC8E225CA9ED9305CB4BBE7E4E255AB3590BACC80FA93000\"\r\n        }\r\n      }\r\n    ],\r\n    \"TransactionIndex\": 0,\r\n    \"TransactionResult\": \"tesSUCCESS\"\r\n  }";

	@Test
	public void testParsingTransactionMetaWithSTArray() throws Exception {
		TransactionMeta meta = (TransactionMeta) STObject.fromJSON(unrelatedS2);
		STArray nodes = meta.get(STArray.AffectedNodes);

		// Some helper methods to get enum fields
		assertEquals(EngineResult.tesSUCCESS, meta.engineResult());

		STObject firstAffected = nodes.get(0);
		// STObject secondAffected = nodes.get(1);
		// assertEquals(LedgerEntryType.AccountRoot,
		// ((AccountRoot)
		// firstAffected.get(STObject.ModifiedNode)).ledgerEntryType());

		// assertTrue(firstAffected.has(STObject.CreatedNode));
		// assertEquals(35, finalSequence(firstAffected).longValue());
		// assertEquals(177, finalSequence(secondAffected).longValue());
	}

	@Test
	public  void testMissingPrevFields() throws Exception {
		String error_9A5A9ECA97CD3F3E028F3BC663E336F7643A4A58749AD2A63D4399EE37175C1D = "{\r\n   \"engine_result\": \"tesSUCCESS\",\r\n   \"engine_result_code\": 0,\r\n   \"engine_result_message\": \"The transaction was applied. Only final in a validated ledger.\",\r\n   \"ledger_hash\": \"CE19CA0188F6B01453E05A8B9FC6AE94FC260B5B5059B513EE2119199FDE9173\",\r\n   \"ledger_index\": 30754741,\r\n   \"meta\": {\r\n     \"AffectedNodes\": [{\r\n       \"CreatedNode\": {\r\n         \"LedgerEntryType\": \"Offer\",\r\n         \"LedgerIndex\": \"60B13F57D2B799D2C05EFB11C7C032D35D9320738AB07C6BDDAC3C10BBCFDFF1\",\r\n         \"NewFields\": {\r\n           \"Account\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\r\n           \"BookDirectory\": \"7E984AD10069041B9B957C73D05AF2AB3D117C0CCAF7FDA5500AC40B67AED936\",\r\n           \"OwnerNode\": \"000000000000000F\",\r\n           \"Sequence\": 4740,\r\n           \"TakerGets\": {\r\n             \"currency\": \"JPY\",\r\n             \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n             \"value\": \"3300\"\r\n           },\r\n           \"TakerPays\": {\r\n             \"currency\": \"RJP\",\r\n             \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n             \"value\": \"0.1\"\r\n           }\r\n         }\r\n       }\r\n     }, {\r\n       \"ModifiedNode\": {\r\n         \"FinalFields\": {\r\n           \"Account\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\r\n           \"Balance\": \"6060125313\",\r\n           \"Flags\": 0,\r\n           \"OwnerCount\": 10,\r\n           \"Sequence\": 4741\r\n         },\r\n         \"LedgerEntryType\": \"AccountRoot\",\r\n         \"LedgerIndex\": \"72A59CDF8FFBF65C20D01D3A3D5DA5BAE3158A3881E7AEE525A01B1CC73D32DD\",\r\n         \"PreviousFields\": {\r\n           \"Balance\": \"6060125325\",\r\n           \"Sequence\": 4740\r\n         },\r\n         \"PreviousTxnID\": \"58950678AE345C974070D196D73F2244C5F8E90AF7C864D30087AE8F2560E697\",\r\n         \"PreviousTxnLgrSeq\": 30754511\r\n       }\r\n     }, {\r\n       \"CreatedNode\": {\r\n         \"LedgerEntryType\": \"DirectoryNode\",\r\n         \"LedgerIndex\": \"7E984AD10069041B9B957C73D05AF2AB3D117C0CCAF7FDA5500AC40B67AED936\",\r\n         \"NewFields\": {\r\n           \"ExchangeRate\": \"500AC40B67AED936\",\r\n           \"RootIndex\": \"7E984AD10069041B9B957C73D05AF2AB3D117C0CCAF7FDA5500AC40B67AED936\",\r\n           \"TakerGetsCurrency\": \"0000000000000000000000004A50590000000000\",\r\n           \"TakerGetsIssuer\": \"6F2531F2B8CDB96D6D986D9D75CC0156DF2C5387\",\r\n           \"TakerPaysCurrency\": \"000000000000000000000000524A500000000000\",\r\n           \"TakerPaysIssuer\": \"6F2531F2B8CDB96D6D986D9D75CC0156DF2C5387\"\r\n         }\r\n       }\r\n     }, {\r\n       \"ModifiedNode\": {\r\n         \"FinalFields\": {\r\n           \"Flags\": 0,\r\n           \"IndexPrevious\": \"0000000000000006\",\r\n           \"Owner\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\r\n           \"RootIndex\": \"C5383B94DDE4BE2A184757D80837080C4D1EAB80789FE39F7D7AECFB0D0304BB\"\r\n         },\r\n         \"LedgerEntryType\": \"DirectoryNode\",\r\n         \"LedgerIndex\": \"91565E4F1A8282718C8D6ED8EFEE2B5DC18101FC76D0AE436F46194F4567EF5E\"\r\n       }\r\n     }, {\r\n       \"DeletedNode\": {\r\n         \"FinalFields\": {\r\n           \"ExchangeRate\": \"590B6C0684F3F000\",\r\n           \"Flags\": 0,\r\n           \"RootIndex\": \"DCAAC0CDAC8DA851AC8E225CA9ED9305CB4BBE7E4E255AB3590B6C0684F3F000\",\r\n           \"TakerGetsCurrency\": \"000000000000000000000000524A500000000000\",\r\n           \"TakerGetsIssuer\": \"6F2531F2B8CDB96D6D986D9D75CC0156DF2C5387\",\r\n           \"TakerPaysCurrency\": \"0000000000000000000000004A50590000000000\",\r\n           \"TakerPaysIssuer\": \"6F2531F2B8CDB96D6D986D9D75CC0156DF2C5387\"\r\n         },\r\n         \"LedgerEntryType\": \"DirectoryNode\",\r\n         \"LedgerIndex\": \"DCAAC0CDAC8DA851AC8E225CA9ED9305CB4BBE7E4E255AB3590B6C0684F3F000\"\r\n       }\r\n     }, {\r\n       \"DeletedNode\": {\r\n         \"FinalFields\": {\r\n           \"Account\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\r\n           \"BookDirectory\": \"DCAAC0CDAC8DA851AC8E225CA9ED9305CB4BBE7E4E255AB3590B6C0684F3F000\",\r\n           \"BookNode\": \"0000000000000000\",\r\n           \"Flags\": 131072,\r\n           \"OwnerNode\": \"000000000000000F\",\r\n           \"PreviousTxnID\": \"58950678AE345C974070D196D73F2244C5F8E90AF7C864D30087AE8F2560E697\",\r\n           \"PreviousTxnLgrSeq\": 30754511,\r\n           \"Sequence\": 4739,\r\n           \"TakerGets\": {\r\n             \"currency\": \"RJP\",\r\n             \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n             \"value\": \"6642980000000000e-26\"\r\n           },\r\n           \"TakerPays\": {\r\n             \"currency\": \"JPY\",\r\n             \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n             \"value\": \"0.000002135718\"\r\n           }\r\n         },\r\n         \"LedgerEntryType\": \"Offer\",\r\n         \"LedgerIndex\": \"FAE681F5F36A40EC2CB4C47AF50EBCFE646EC786B52C5003E7EC7469BC255475\"\r\n       }\r\n     }],\r\n     \"TransactionIndex\": 87,\r\n     \"TransactionResult\": \"tesSUCCESS\"\r\n   },\r\n   \"status\": \"closed\",\r\n   \"transaction\": {\r\n     \"Account\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\r\n     \"Fee\": \"12\",\r\n     \"Flags\": 2147483648,\r\n     \"LastLedgerSequence\": 30754743,\r\n     \"Memos\": [{\r\n       \"Memo\": {\r\n         \"MemoData\": \"726D2D312E322E33\",\r\n         \"MemoType\": \"636C69656E74\"\r\n       }\r\n     }],\r\n     \"Sequence\": 4740,\r\n     \"SigningPubKey\": \"02E2F1208D1715E18B0957FC819546FA7434B4A19EE38321932D2ED28FA090678E\",\r\n     \"TakerGets\": {\r\n       \"currency\": \"JPY\",\r\n       \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n       \"value\": \"3300\"\r\n     },\r\n     \"TakerPays\": {\r\n       \"currency\": \"RJP\",\r\n       \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n       \"value\": \"0.1\"\r\n     },\r\n     \"TransactionType\": \"OfferCreate\",\r\n     \"TxnSignature\": \"30440220101ABC9FB31CFAC747C5B9833341C4832A194C2C57C3A8060E1D9EB2CD6938240220029CF0AB692146431AAB7B8766FD236DEF1D31945F689403917ECF2546B8430A\",\r\n     \"date\": 551676281,\r\n     \"hash\": \"9A5A9ECA97CD3F3E028F3BC663E336F7643A4A58749AD2A63D4399EE37175C1D\",\r\n     \"owner_funds\": \"9999.86990579025\"\r\n   },\r\n   \"type\": \"transaction\",\r\n   \"validated\": true\r\n }";

		String error_EF7BF9F523E74777027EE4765F542532FF89B6E1132685D6E75C4AFFF072151C = "{\r\n  \"engine_result\": \"tesSUCCESS\",\r\n  \"engine_result_code\": 0,\r\n  \"engine_result_message\": \"The transaction was applied. Only final in a validated ledger.\",\r\n  \"ledger_hash\": \"1942CA83566B16802700FB537BAE8ED13EB9A6C5E79EF8072F633C3FF0076AFF\",\r\n  \"ledger_index\": 30752350,\r\n  \"meta\": {\r\n    \"AffectedNodes\": [{\r\n        \"ModifiedNode\": {\r\n          \"FinalFields\": {\r\n            \"Account\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\r\n            \"Balance\": \"6060125289\",\r\n            \"Flags\": 0,\r\n            \"OwnerCount\": 9,\r\n            \"Sequence\": 4743\r\n          },\r\n          \"LedgerEntryType\": \"AccountRoot\",\r\n          \"LedgerIndex\": \"72A59CDF8FFBF65C20D01D3A3D5DA5BAE3158A3881E7AEE525A01B1CC73D32DD\",\r\n          \"PreviousFields\": {\r\n            \"Balance\": \"6060125301\",\r\n            \"OwnerCount\": 10,\r\n            \"Sequence\": 4742\r\n          },\r\n          \"PreviousTxnID\": \"503DD0C7597051A4592E8DABC2BA4AA286231FFE3A30AB855D9A569CCB887132\",\r\n          \"PreviousTxnLgrSeq\": 30756200\r\n        }\r\n      },\r\n      {\r\n        \"DeletedNode\": {\r\n          \"FinalFields\": {\r\n            \"Account\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\r\n            \"BookDirectory\": \"DCAAC0CDAC8DA851AC8E225CA9ED9305CB4BBE7E4E255AB3590BACC80FA93000\",\r\n            \"BookNode\": \"0000000000000000\",\r\n            \"Flags\": 131072,\r\n            \"OwnerNode\": \"000000000000000F\",\r\n            \"PreviousTxnID\": \"503DD0C7597051A4592E8DABC2BA4AA286231FFE3A30AB855D9A569CCB887132\",\r\n            \"PreviousTxnLgrSeq\": 30756200,\r\n            \"Sequence\": 4741,\r\n            \"TakerGets\": {\r\n              \"currency\": \"RJP\",\r\n              \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n              \"value\": \"0.1\"\r\n            },\r\n            \"TakerPays\": {\r\n              \"currency\": \"JPY\",\r\n              \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n              \"value\": \"3286.2\"\r\n            }\r\n          },\r\n          \"LedgerEntryType\": \"Offer\",\r\n          \"LedgerIndex\": \"76BEC8D4790AC90F0C9FCECFCBE9DC6969AD2866114362AE4AA2B0382F785B29\"\r\n        }\r\n      },\r\n      {\r\n        \"ModifiedNode\": {\r\n          \"FinalFields\": {\r\n            \"Flags\": 0,\r\n            \"IndexPrevious\": \"0000000000000006\",\r\n            \"Owner\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\r\n            \"RootIndex\": \"C5383B94DDE4BE2A184757D80837080C4D1EAB80789FE39F7D7AECFB0D0304BB\"\r\n          },\r\n          \"LedgerEntryType\": \"DirectoryNode\",\r\n          \"LedgerIndex\": \"91565E4F1A8282718C8D6ED8EFEE2B5DC18101FC76D0AE436F46194F4567EF5E\"\r\n        }\r\n      },\r\n      {\r\n        \"DeletedNode\": {\r\n          \"FinalFields\": {\r\n            \"ExchangeRate\": \"590BACC80FA93000\",\r\n            \"Flags\": 0,\r\n            \"RootIndex\": \"DCAAC0CDAC8DA851AC8E225CA9ED9305CB4BBE7E4E255AB3590BACC80FA93000\",\r\n            \"TakerGetsCurrency\": \"000000000000000000000000524A500000000000\",\r\n            \"TakerGetsIssuer\": \"6F2531F2B8CDB96D6D986D9D75CC0156DF2C5387\",\r\n            \"TakerPaysCurrency\": \"0000000000000000000000004A50590000000000\",\r\n            \"TakerPaysIssuer\": \"6F2531F2B8CDB96D6D986D9D75CC0156DF2C5387\"\r\n          },\r\n          \"LedgerEntryType\": \"DirectoryNode\",\r\n          \"LedgerIndex\": \"DCAAC0CDAC8DA851AC8E225CA9ED9305CB4BBE7E4E255AB3590BACC80FA93000\"\r\n        }\r\n      }\r\n    ],\r\n    \"TransactionIndex\": 0,\r\n    \"TransactionResult\": \"tesSUCCESS\"\r\n  },\r\n  \"status\": \"closed\",\r\n  \"transaction\": {\r\n    \"Account\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\r\n    \"Fee\": \"12\",\r\n    \"Flags\": 2147483648,\r\n    \"LastLedgerSequence\": 30752352,\r\n    \"Memos\": [{\r\n      \"Memo\": {\r\n        \"MemoData\": \"726D2D312E322E33\",\r\n        \"MemoType\": \"636C69656E74\"\r\n      }\r\n    }],\r\n    \"Sequence\": 4734,\r\n    \"SigningPubKey\": \"02E2F1208D1715E18B0957FC819546FA7434B4A19EE38321932D2ED28FA090678E\",\r\n    \"TakerGets\": {\r\n      \"currency\": \"JPY\",\r\n      \"issuer\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n      \"value\": \"159.25\"\r\n    },\r\n    \"TakerPays\": \"5000000\",\r\n    \"TransactionType\": \"OfferCreate\",\r\n    \"TxnSignature\": \"3044022032523881EED58446104B57C17EBF71D8125D7702DC054BA6B3EFDD8CA1755AF7022013A240D77602E319F67ED6B7AA7868A8E986586E1DF015833C829223EBA6A81C\",\r\n    \"date\": 551667961,\r\n    \"hash\": \"8E943C78B4783AF66571EC86331DC8C4444DD34A24A4A9D24748F633AE71ED5F\",\r\n    \"owner_funds\": \"7727.279530849417\"\r\n  },\r\n  \"type\": \"transaction\",\r\n  \"validated\": true\r\n}";
		Counter.testOfferQuality(error_9A5A9ECA97CD3F3E028F3BC663E336F7643A4A58749AD2A63D4399EE37175C1D);
		Counter.testOfferQuality(error_EF7BF9F523E74777027EE4765F542532FF89B6E1132685D6E75C4AFFF072151C);


	}

	public static void testOfferQuality(String raw) throws Exception {
		System.out.println("****NEW TX****");

		JSONObject transaction = new JSONObject(raw);
		JSONObject metaJSON = (JSONObject) transaction.remove("meta");
		TransactionMeta meta = (TransactionMeta) STObject.fromJSONObject(metaJSON);
		Transaction txn = (Transaction) STObject.fromJSONObject(transaction.getJSONObject("transaction"));

		ArrayList<Offer> offersExecuted = new ArrayList<Offer>();
		if (txn.get(Field.TransactionType).toString().equals("OffcerCrate")) {
			Amount gets = txn.get(Amount.TakerGets);
			Amount pays = txn.get(Amount.TakerPays);

			System.out.println("---------------------------------------------------------------");
			System.out.println("OfferCreate ");
			System.out.println("---------------------------------------------------------------");
			System.out.println("Get/Pay:    " + gets.currencyString() + "/" + pays.currencyString());
			System.out.println("Bid:        " + gets.computeQuality(pays));
			System.out.println("TakerPays:  " + pays);
			System.out.println("TakerGets:  " + gets);
		} else if (txn.get(Field.TransactionType).toString().equals("OfferCancel")) {
			System.out.println("---------------------------------------------------------------");
			System.out.println("OfferCancel ");
			System.out.println("---------------------------------------------------------------");
		} else if (txn.get(Field.TransactionType).toString().equals("Payment")) {
			System.out.println("---------------------------------------------------------------");
			System.out.println("Payment ");
			System.out.println("---------------------------------------------------------------");

		} else {
			System.out.println("---------------------------------------------------------------");
			System.out.println(txn.get(Field.TransactionType).toString());
			System.out.println("---------------------------------------------------------------");
		}

		System.out.println(txn.prettyJSON());

		for (AffectedNode node : meta.affectedNodes()) {
			if (!node.isCreatedNode()) {
				// Merge fields from node / node.FinalFields && node.PreviousFields
				// to determine state of node prior to transaction.
				// Any fields that were in PreviousFields will be have their final
				// values
				// in a nested STObject keyed by FinalFields.
				LedgerEntry asPrevious = (LedgerEntry) node.nodeAsPrevious();
				// If it's an offer
				if (asPrevious instanceof Offer) {
					// We can down-cast this to use Offer specific methods
					offersExecuted.add((Offer) asPrevious);
				}
			} else {
				LedgerEntry asFinal = (LedgerEntry) node.nodeAsPrevious();
				if (asFinal instanceof Offer) {
					Offer offer = (Offer) asFinal;

					System.out.println("---------------------------------------------------------------");
					System.out.println("Offer Created");
					System.out.println("---------------------------------------------------------------");
					System.out.println("Get/Pay:    " + offer.getPayCurrencyPair());
					System.out.println("Bid:        " + offer.bidQuality());
					System.out.println("TakerPays:  " + offer.takerPays());
					System.out.println("TakerGets:  " + offer.takerGets());
					System.out.println("---------------------------------------------------------------");
					System.out.println(offer.prettyJSON());
				}
			}
		}

		Collections.sort(offersExecuted, Offer.qualityAscending);
		for (Offer offer : offersExecuted) {
			STObject finalFields = offer.get(STObject.FinalFields);
			if (finalFields == null) {
				System.out.println("FinalFields is null");
				// System.out.println(offer.prettyJSON());

			} else {
				STObject executed = offer.executed(offer.get(STObject.FinalFields));

				// This will be computed from the BookDirectory field
				System.out.println("---------------------------------------------------------------");
				System.out.println("Offer Executed");
				System.out.println("---------------------------------------------------------------");
				System.out.println("Get/Pay: " + offer.getPayCurrencyPair());
				System.out.println("Ask:     " + offer.directoryAskQuality().stripTrailingZeros().toPlainString());
				System.out.println("Paid:    " + executed.get(Amount.TakerPays));
				System.out.println("Got:     " + executed.get(Amount.TakerGets));
				System.out.println("---------------------------------------------------------------");
				System.out.println(offer.prettyJSON());
			}

		}
		System.out.println("****END TX****");
		System.out.println("\n");
		System.out.println("\n");

	}

}
