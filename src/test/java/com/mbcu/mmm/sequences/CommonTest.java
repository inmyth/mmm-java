package com.mbcu.mmm.sequences;

import static org.junit.Assert.assertEquals;

import java.util.ArrayList;
import java.util.Collections;

import org.json.JSONObject;
import org.junit.Test;

import com.mbcu.mmm.models.internal.Config;
import com.ripple.core.coretypes.Amount;
import com.ripple.core.coretypes.STObject;
import com.ripple.core.coretypes.hash.Hash256;
import com.ripple.core.fields.Field;
import com.ripple.core.types.known.sle.LedgerEntry;
import com.ripple.core.types.known.sle.entries.Offer;
import com.ripple.core.types.known.tx.Transaction;
import com.ripple.core.types.known.tx.result.AffectedNode;
import com.ripple.core.types.known.tx.result.TransactionMeta;

public class CommonTest {
	private static final String configPath = "config.txt";
	
	
//	@Test
//	public void autoBridge() throws Exception{
//		Common c = Common.newInstance( Config.build(configPath));
//		System.out.println("Autobridge with single element majority");
//		String oneToOne = "{\"engine_result\":\"tesSUCCESS\",\"engine_result_code\":0,\"engine_result_message\":\"The transaction was applied. Only final in a validated ledger.\",\"ledger_hash\":\"DE54C3757678AC1A4153B1357D0DE94264BC5F167183B7FE5625967ABC0DBCD0\",\"ledger_index\":30927336,\"meta\":{\"AffectedNodes\":[{\"ModifiedNode\":{\"FinalFields\":{\"Account\":\"rKLPBY3nEhETSThEfWRaHNBH1Rxeo57UGn\",\"BookDirectory\":\"7035F45D0D6677B54720F2A9CBD0EA1155313D0F038A9E5B5D2184238194439F\",\"BookNode\":\"0000000000000000\",\"Flags\":0,\"OwnerNode\":\"0000000000000012\",\"Sequence\":664,\"TakerGets\":{\"currency\":\"RJP\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"3.07\"},\"TakerPays\":\"2896226416\"},\"LedgerEntryType\":\"Offer\",\"LedgerIndex\":\"0ED3CD935ABB3FCA15ABB71796A9EE33B63E8ACC921FBA43156F1A592D825460\",\"PreviousFields\":{\"TakerGets\":{\"currency\":\"RJP\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"3.08\"},\"TakerPays\":\"2905660378\"},\"PreviousTxnID\":\"67EB60F07CAC3F4EE4C57DAA432E830080423A25B49AEA7A03B54875A2F7F02E\",\"PreviousTxnLgrSeq\":30927130}},{\"ModifiedNode\":{\"FinalFields\":{\"Balance\":{\"currency\":\"JPY\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"20556.88790576798\"},\"Flags\":1114112,\"HighLimit\":{\"currency\":\"JPY\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0\"},\"HighNode\":\"0000000000000399\",\"LowLimit\":{\"currency\":\"JPY\",\"issuer\":\"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\"value\":\"100000\"},\"LowNode\":\"0000000000000001\"},\"LedgerEntryType\":\"RippleState\",\"LedgerIndex\":\"21110D01A36A7EB20188B11D685B847322DE631145C31803E1760550FA399BAD\",\"PreviousFields\":{\"Balance\":{\"currency\":\"JPY\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"20817.34172866395\"}},\"PreviousTxnID\":\"67EB60F07CAC3F4EE4C57DAA432E830080423A25B49AEA7A03B54875A2F7F02E\",\"PreviousTxnLgrSeq\":30927130}},{\"ModifiedNode\":{\"FinalFields\":{\"Balance\":{\"currency\":\"RJP\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"4.588899891940538\"},\"Flags\":1114112,\"HighLimit\":{\"currency\":\"RJP\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0\"},\"HighNode\":\"00000000000003FB\",\"LowLimit\":{\"currency\":\"RJP\",\"issuer\":\"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\"value\":\"10000\"},\"LowNode\":\"0000000000000006\",\"LowQualityIn\":1000000000},\"LedgerEntryType\":\"RippleState\",\"LedgerIndex\":\"4A8FE98984B510E3F0223CB8C9110FA370EC545BCD6CE6863C8405E5BC360423\",\"PreviousFields\":{\"Balance\":{\"currency\":\"RJP\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"4.578899891940538\"}},\"PreviousTxnID\":\"67EB60F07CAC3F4EE4C57DAA432E830080423A25B49AEA7A03B54875A2F7F02E\",\"PreviousTxnLgrSeq\":30927130}},{\"ModifiedNode\":{\"FinalFields\":{\"Account\":\"rKLPBY3nEhETSThEfWRaHNBH1Rxeo57UGn\",\"BookDirectory\":\"11EEBF7DFC0076D299322039F1493C921CAAEFE85B322E5D5009C9EE45BFE7F4\",\"BookNode\":\"0000000000000000\",\"Flags\":131072,\"OwnerNode\":\"0000000000000019\",\"Sequence\":909,\"TakerGets\":\"781748105\",\"TakerPays\":{\"currency\":\"JPY\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"21539.50551443824\"}},\"LedgerEntryType\":\"Offer\",\"LedgerIndex\":\"5D9EDF20A4EC58656E020967B33B101748257E88F4A2A7A33335926340A7853F\",\"PreviousFields\":{\"TakerGets\":\"791182067\",\"TakerPays\":{\"currency\":\"JPY\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"21799.43946942423\"}},\"PreviousTxnID\":\"E2DE3F155C66C415C9DFBDB7000AB71D74E8AB6FEA4339CB514E90B879C0C87D\",\"PreviousTxnLgrSeq\":30927186}},{\"ModifiedNode\":{\"FinalFields\":{\"Account\":\"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\"Balance\":\"2592222282\",\"Flags\":0,\"OwnerCount\":9,\"Sequence\":5514},\"LedgerEntryType\":\"AccountRoot\",\"LedgerIndex\":\"72A59CDF8FFBF65C20D01D3A3D5DA5BAE3158A3881E7AEE525A01B1CC73D32DD\",\"PreviousFields\":{\"Balance\":\"2592222294\",\"Sequence\":5513},\"PreviousTxnID\":\"67EB60F07CAC3F4EE4C57DAA432E830080423A25B49AEA7A03B54875A2F7F02E\",\"PreviousTxnLgrSeq\":30927130}},{\"ModifiedNode\":{\"FinalFields\":{\"Balance\":{\"currency\":\"RJP\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"-109.6213379762039\"},\"Flags\":2228224,\"HighLimit\":{\"currency\":\"RJP\",\"issuer\":\"rKLPBY3nEhETSThEfWRaHNBH1Rxeo57UGn\",\"value\":\"10000\"},\"HighNode\":\"0000000000000000\",\"HighQualityIn\":1000000000,\"LowLimit\":{\"currency\":\"RJP\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0\"},\"LowNode\":\"0000000000000324\"},\"LedgerEntryType\":\"RippleState\",\"LedgerIndex\":\"C0ADFF611CD723F588F6E274696526AD6E3E3061D43B92C2761A7EDB64967999\",\"PreviousFields\":{\"Balance\":{\"currency\":\"RJP\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"-109.6313579762039\"}},\"PreviousTxnID\":\"67EB60F07CAC3F4EE4C57DAA432E830080423A25B49AEA7A03B54875A2F7F02E\",\"PreviousTxnLgrSeq\":30927130}},{\"ModifiedNode\":{\"FinalFields\":{\"Balance\":{\"currency\":\"JPY\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"-12470320.02357659\"},\"Flags\":2228224,\"HighLimit\":{\"currency\":\"JPY\",\"issuer\":\"rKLPBY3nEhETSThEfWRaHNBH1Rxeo57UGn\",\"value\":\"50000000\"},\"HighNode\":\"0000000000000000\",\"HighQualityIn\":1000000000,\"LowLimit\":{\"currency\":\"JPY\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0\"},\"LowNode\":\"0000000000000323\"},\"LedgerEntryType\":\"RippleState\",\"LedgerIndex\":\"D727CD2D19774BA754A358FDFD2744A7563BB99ED4F0E9979A1B3565758D9A17\",\"PreviousFields\":{\"Balance\":{\"currency\":\"JPY\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"-12470060.08962161\"}},\"PreviousTxnID\":\"E2DE3F155C66C415C9DFBDB7000AB71D74E8AB6FEA4339CB514E90B879C0C87D\",\"PreviousTxnLgrSeq\":30927186}}],\"TransactionIndex\":5,\"TransactionResult\":\"tesSUCCESS\"},\"status\":\"closed\",\"transaction\":{\"Account\":\"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\"Fee\":\"12\",\"Flags\":2147483648,\"LastLedgerSequence\":30927338,\"Memos\":[{\"Memo\":{\"MemoData\":\"726D2D312E322E33\",\"MemoType\":\"636C69656E74\"}}],\"Sequence\":5513,\"SigningPubKey\":\"02E2F1208D1715E18B0957FC819546FA7434B4A19EE38321932D2ED28FA090678E\",\"TakerGets\":{\"currency\":\"JPY\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"260\"},\"TakerPays\":{\"currency\":\"RJP\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0.01\"},\"TransactionType\":\"OfferCreate\",\"TxnSignature\":\"304402201AB0A4BF8960D69699D8D253B2B361C31CD8F632F22EE2F8C2CB2F85E678CF22022068C9987BFE0023DF2B4E39608114A26F84F258435911383A1468AF66A405A507\",\"date\":552282502,\"hash\":\"9D499203719FF6F6D5750198066DF7F0B68AD50DF6A5CF93190D658BE077F36B\",\"owner_funds\":\"20556.88790576798\"},\"type\":\"transaction\",\"validated\":true}\n";
//		c.filterTx(oneToOne);
//		System.out.println("Autobridge with single element majority");
//		String oneToOneReversed = "{\"engine_result\":\"tesSUCCESS\",\"engine_result_code\":0,\"engine_result_message\":\"The transaction was applied. Only final in a validated ledger.\",\"ledger_hash\":\"DE54C3757678AC1A4153B1357D0DE94264BC5F167183B7FE5625967ABC0DBCD0\",\"ledger_index\":30927336,\"meta\":{\"AffectedNodes\":[{\"ModifiedNode\":{\"FinalFields\":{\"Account\":\"rKLPBY3nEhETSThEfWRaHNBH1Rxeo57UGn\",\"BookDirectory\":\"7035F45D0D6677B54720F2A9CBD0EA1155313D0F038A9E5B5D2184238194439F\",\"BookNode\":\"0000000000000000\",\"Flags\":0,\"OwnerNode\":\"0000000000000012\",\"Sequence\":664,\"TakerGets\":{\"currency\":\"RJP\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"3.07\"},\"TakerPays\":\"2896226416\"},\"LedgerEntryType\":\"Offer\",\"LedgerIndex\":\"0ED3CD935ABB3FCA15ABB71796A9EE33B63E8ACC921FBA43156F1A592D825460\",\"PreviousFields\":{\"TakerGets\":{\"currency\":\"RJP\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"3.08\"},\"TakerPays\":\"2905660378\"},\"PreviousTxnID\":\"67EB60F07CAC3F4EE4C57DAA432E830080423A25B49AEA7A03B54875A2F7F02E\",\"PreviousTxnLgrSeq\":30927130}},{\"ModifiedNode\":{\"FinalFields\":{\"Balance\":{\"currency\":\"JPY\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"20556.88790576798\"},\"Flags\":1114112,\"HighLimit\":{\"currency\":\"JPY\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0\"},\"HighNode\":\"0000000000000399\",\"LowLimit\":{\"currency\":\"JPY\",\"issuer\":\"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\"value\":\"100000\"},\"LowNode\":\"0000000000000001\"},\"LedgerEntryType\":\"RippleState\",\"LedgerIndex\":\"21110D01A36A7EB20188B11D685B847322DE631145C31803E1760550FA399BAD\",\"PreviousFields\":{\"Balance\":{\"currency\":\"JPY\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"20817.34172866395\"}},\"PreviousTxnID\":\"67EB60F07CAC3F4EE4C57DAA432E830080423A25B49AEA7A03B54875A2F7F02E\",\"PreviousTxnLgrSeq\":30927130}},{\"ModifiedNode\":{\"FinalFields\":{\"Balance\":{\"currency\":\"RJP\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"4.588899891940538\"},\"Flags\":1114112,\"HighLimit\":{\"currency\":\"RJP\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0\"},\"HighNode\":\"00000000000003FB\",\"LowLimit\":{\"currency\":\"RJP\",\"issuer\":\"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\"value\":\"10000\"},\"LowNode\":\"0000000000000006\",\"LowQualityIn\":1000000000},\"LedgerEntryType\":\"RippleState\",\"LedgerIndex\":\"4A8FE98984B510E3F0223CB8C9110FA370EC545BCD6CE6863C8405E5BC360423\",\"PreviousFields\":{\"Balance\":{\"currency\":\"RJP\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"4.578899891940538\"}},\"PreviousTxnID\":\"67EB60F07CAC3F4EE4C57DAA432E830080423A25B49AEA7A03B54875A2F7F02E\",\"PreviousTxnLgrSeq\":30927130}},{\"ModifiedNode\":{\"FinalFields\":{\"Account\":\"rKLPBY3nEhETSThEfWRaHNBH1Rxeo57UGn\",\"BookDirectory\":\"11EEBF7DFC0076D299322039F1493C921CAAEFE85B322E5D5009C9EE45BFE7F4\",\"BookNode\":\"0000000000000000\",\"Flags\":131072,\"OwnerNode\":\"0000000000000019\",\"Sequence\":909,\"TakerGets\":\"781748105\",\"TakerPays\":{\"currency\":\"JPY\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"21539.50551443824\"}},\"LedgerEntryType\":\"Offer\",\"LedgerIndex\":\"5D9EDF20A4EC58656E020967B33B101748257E88F4A2A7A33335926340A7853F\",\"PreviousFields\":{\"TakerGets\":\"791182067\",\"TakerPays\":{\"currency\":\"JPY\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"21799.43946942423\"}},\"PreviousTxnID\":\"E2DE3F155C66C415C9DFBDB7000AB71D74E8AB6FEA4339CB514E90B879C0C87D\",\"PreviousTxnLgrSeq\":30927186}},{\"ModifiedNode\":{\"FinalFields\":{\"Account\":\"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\"Balance\":\"2592222282\",\"Flags\":0,\"OwnerCount\":9,\"Sequence\":5514},\"LedgerEntryType\":\"AccountRoot\",\"LedgerIndex\":\"72A59CDF8FFBF65C20D01D3A3D5DA5BAE3158A3881E7AEE525A01B1CC73D32DD\",\"PreviousFields\":{\"Balance\":\"2592222294\",\"Sequence\":5513},\"PreviousTxnID\":\"67EB60F07CAC3F4EE4C57DAA432E830080423A25B49AEA7A03B54875A2F7F02E\",\"PreviousTxnLgrSeq\":30927130}},{\"ModifiedNode\":{\"FinalFields\":{\"Balance\":{\"currency\":\"RJP\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"-109.6213379762039\"},\"Flags\":2228224,\"HighLimit\":{\"currency\":\"RJP\",\"issuer\":\"rKLPBY3nEhETSThEfWRaHNBH1Rxeo57UGn\",\"value\":\"10000\"},\"HighNode\":\"0000000000000000\",\"HighQualityIn\":1000000000,\"LowLimit\":{\"currency\":\"RJP\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0\"},\"LowNode\":\"0000000000000324\"},\"LedgerEntryType\":\"RippleState\",\"LedgerIndex\":\"C0ADFF611CD723F588F6E274696526AD6E3E3061D43B92C2761A7EDB64967999\",\"PreviousFields\":{\"Balance\":{\"currency\":\"RJP\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"-109.6313579762039\"}},\"PreviousTxnID\":\"67EB60F07CAC3F4EE4C57DAA432E830080423A25B49AEA7A03B54875A2F7F02E\",\"PreviousTxnLgrSeq\":30927130}},{\"ModifiedNode\":{\"FinalFields\":{\"Balance\":{\"currency\":\"JPY\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"-12470320.02357659\"},\"Flags\":2228224,\"HighLimit\":{\"currency\":\"JPY\",\"issuer\":\"rKLPBY3nEhETSThEfWRaHNBH1Rxeo57UGn\",\"value\":\"50000000\"},\"HighNode\":\"0000000000000000\",\"HighQualityIn\":1000000000,\"LowLimit\":{\"currency\":\"JPY\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0\"},\"LowNode\":\"0000000000000323\"},\"LedgerEntryType\":\"RippleState\",\"LedgerIndex\":\"D727CD2D19774BA754A358FDFD2744A7563BB99ED4F0E9979A1B3565758D9A17\",\"PreviousFields\":{\"Balance\":{\"currency\":\"JPY\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"-12470060.08962161\"}},\"PreviousTxnID\":\"E2DE3F155C66C415C9DFBDB7000AB71D74E8AB6FEA4339CB514E90B879C0C87D\",\"PreviousTxnLgrSeq\":30927186}}],\"TransactionIndex\":5,\"TransactionResult\":\"tesSUCCESS\"},\"status\":\"closed\",\"transaction\":{\"Account\":\"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\"Fee\":\"12\",\"Flags\":2147483648,\"LastLedgerSequence\":30927338,\"Memos\":[{\"Memo\":{\"MemoData\":\"726D2D312E322E33\",\"MemoType\":\"636C69656E74\"}}],\"Sequence\":5513,\"SigningPubKey\":\"02E2F1208D1715E18B0957FC819546FA7434B4A19EE38321932D2ED28FA090678E\",\"TakerGets\":{\"currency\":\"JPY\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"260\"},\"TakerPays\":{\"currency\":\"RJP\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0.01\"},\"TransactionType\":\"OfferCreate\",\"TxnSignature\":\"304402201AB0A4BF8960D69699D8D253B2B361C31CD8F632F22EE2F8C2CB2F85E678CF22022068C9987BFE0023DF2B4E39608114A26F84F258435911383A1468AF66A405A507\",\"date\":552282502,\"hash\":\"9D499203719FF6F6D5750198066DF7F0B68AD50DF6A5CF93190D658BE077F36B\",\"owner_funds\":\"20556.88790576798\"},\"type\":\"transaction\",\"validated\":true}\n";
//		c.filterTx(oneToOneReversed);
//	}

	@Test
	public void autoBridgeMulti1() throws Exception{
		Common c = Common.newInstance( Config.build(configPath));

		System.out.println("017-07-03, 22:32:30 Made offer to sell 0.05 RJP.MrRipple at price 32,500 JPY.MrRipple\n\n    sold 0.042997 XRP at price 27.9755 JPY.MrRipple\n    sold 0.000112 XRP at price 27.9622 JPY.MrRipple\n    sold 0.000590715 RJP.MrRipple at price 1,162.79 XRP\n    sold 0.1192 XRP at price 27.9766 JPY.MrRipple\n    sold 0.0000195500 RJP.MrRipple at price 1,162.81 XRP\n    sold 0.547302 XRP at price 27.9767 JPY.MrRipple\n    placed new order selling 0.0493897 RJP.MrRipple at price 32,500.0 JPY.MrRipple ");
		String oneConsumesMany1 = " {\"engine_result\":\"tesSUCCESS\",\"engine_result_code\":0,\"engine_result_message\":\"The transaction was applied. Only final in a validated ledger.\",\"ledger_hash\":\"D6EE222848B5D51ECE1BFAF1CF2ABD5EC3438D81F2DA0487B68064DABCBD9306\",\"ledger_index\":30963204,\"meta\":{\"AffectedNodes\":[{\"DeletedNode\":{\"FinalFields\":{\"Account\":\"rKLPBY3nEhETSThEfWRaHNBH1Rxeo57UGn\",\"BookDirectory\":\"A7A2258942BF79A1C2A55DA88560879DC312966AFDD1CD05590CB308061E49AB\",\"BookNode\":\"0000000000000000\",\"Flags\":0,\"OwnerNode\":\"0000000000000153\",\"PreviousTxnID\":\"BCE0C5887EE1AA530B6DEEDBB9279F877AA1E1906BA4A76CE14F9879566CA81D\",\"PreviousTxnLgrSeq\":30962743,\"Sequence\":12629,\"TakerGets\":{\"currency\":\"JPY\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0\"},\"TakerPays\":\"0\"},\"LedgerEntryType\":\"Offer\",\"LedgerIndex\":\"07AB8A7DC66DDE1C13DD6D415A32123E0BCFEA69651671FFAC67A09529F84272\",\"PreviousFields\":{\"TakerGets\":{\"currency\":\"JPY\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"1.2028657851\"},\"TakerPays\":\"42997\"}}},{\"ModifiedNode\":{\"FinalFields\":{\"Balance\":{\"currency\":\"JPY\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"21827.45915626065\"},\"Flags\":1114112,\"HighLimit\":{\"currency\":\"JPY\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0\"},\"HighNode\":\"0000000000000399\",\"LowLimit\":{\"currency\":\"JPY\",\"issuer\":\"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\"value\":\"100000\"},\"LowNode\":\"0000000000000001\"},\"LedgerEntryType\":\"RippleState\",\"LedgerIndex\":\"21110D01A36A7EB20188B11D685B847322DE631145C31803E1760550FA399BAD\",\"PreviousFields\":{\"Balance\":{\"currency\":\"JPY\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"21807.60662953904\"}},\"PreviousTxnID\":\"ED663851F3C8F2D318172A42DAB044368D0D7D434F6276239C7AC57C8FA88EFB\",\"PreviousTxnLgrSeq\":30956618}},{\"DeletedNode\":{\"FinalFields\":{\"Account\":\"rKLPBY3nEhETSThEfWRaHNBH1Rxeo57UGn\",\"BookDirectory\":\"A7A2258942BF79A1C2A55DA88560879DC312966AFDD1CD05590CB493BD366010\",\"BookNode\":\"0000000000000000\",\"Flags\":0,\"OwnerNode\":\"0000000000000153\",\"PreviousTxnID\":\"DC734EEA1B5F2AB6976ED9BAF4FB7603EDFF1217DBCCACC63A0108D803009997\",\"PreviousTxnLgrSeq\":30962743,\"Sequence\":12628,\"TakerGets\":{\"currency\":\"JPY\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0\"},\"TakerPays\":\"0\"},\"LedgerEntryType\":\"Offer\",\"LedgerIndex\":\"3A0AD21A94FBEBE148A95CFF7E8357190133BEBE51A9E448304AE5225233534C\",\"PreviousFields\":{\"TakerGets\":{\"currency\":\"JPY\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0.00313177530561\"},\"TakerPays\":\"112\"}}},{\"ModifiedNode\":{\"FinalFields\":{\"Flags\":0,\"IndexNext\":\"0000000000000155\",\"IndexPrevious\":\"0000000000000153\",\"Owner\":\"rKLPBY3nEhETSThEfWRaHNBH1Rxeo57UGn\",\"RootIndex\":\"4EE2F129C9DC8776082BD8AF7F769EF0EC9A661E740948B2B30B991212D499C8\"},\"LedgerEntryType\":\"DirectoryNode\",\"LedgerIndex\":\"3AB6CA97DFAAFAE03A4FE8CF4E0BF7B958DBEB7F359F53563CAFB8DE68FFBE47\"}},{\"ModifiedNode\":{\"FinalFields\":{\"Flags\":0,\"IndexNext\":\"0000000000001129\",\"IndexPrevious\":\"0000000000001127\",\"Owner\":\"rLjDNH9g1AajRT2pxALZmwesd64p4x9XZJ\",\"RootIndex\":\"718BBB28EE36A3AC1DCBC75790357E2057015302DBA637DFD7851E820B5583BA\"},\"LedgerEntryType\":\"DirectoryNode\",\"LedgerIndex\":\"4481F0633B45A39B944FFE128EFAF7CBE79F0F7BE8E918DC999B75FDD0D87B2B\"}},{\"ModifiedNode\":{\"FinalFields\":{\"Balance\":{\"currency\":\"RJP\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"4.378619551666456\"},\"Flags\":1114112,\"HighLimit\":{\"currency\":\"RJP\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0\"},\"HighNode\":\"00000000000003FB\",\"LowLimit\":{\"currency\":\"RJP\",\"issuer\":\"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\"value\":\"10000\"},\"LowNode\":\"0000000000000006\",\"LowQualityIn\":1000000000},\"LedgerEntryType\":\"RippleState\",\"LedgerIndex\":\"4A8FE98984B510E3F0223CB8C9110FA370EC545BCD6CE6863C8405E5BC360423\",\"PreviousFields\":{\"Balance\":{\"currency\":\"RJP\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"4.379231037283793\"}},\"PreviousTxnID\":\"0E7BDCDA251341DC882D4107C5F950421DA1C92AF698F2ACE5561C5FAFAA8EA9\",\"PreviousTxnLgrSeq\":30935671}},{\"DeletedNode\":{\"FinalFields\":{\"ExchangeRate\":\"4B1E8D82836FD9A4\",\"Flags\":0,\"RootIndex\":\"59E6C90874EE6DE9C3187C89BE98BA49ADFCD5411C40488A4B1E8D82836FD9A4\",\"TakerGetsCurrency\":\"0000000000000000000000000000000000000000\",\"TakerGetsIssuer\":\"0000000000000000000000000000000000000000\",\"TakerPaysCurrency\":\"000000000000000000000000524A500000000000\",\"TakerPaysIssuer\":\"6F2531F2B8CDB96D6D986D9D75CC0156DF2C5387\"},\"LedgerEntryType\":\"DirectoryNode\",\"LedgerIndex\":\"59E6C90874EE6DE9C3187C89BE98BA49ADFCD5411C40488A4B1E8D82836FD9A4\"}},{\"ModifiedNode\":{\"FinalFields\":{\"Account\":\"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\"Balance\":\"2734220398\",\"Flags\":0,\"OwnerCount\":10,\"Sequence\":5599},\"LedgerEntryType\":\"AccountRoot\",\"LedgerIndex\":\"72A59CDF8FFBF65C20D01D3A3D5DA5BAE3158A3881E7AEE525A01B1CC73D32DD\",\"PreviousFields\":{\"Balance\":\"2734220518\",\"OwnerCount\":9,\"Sequence\":5598},\"PreviousTxnID\":\"C210644C2CE2440B1383CD0F1F356A95D4D9D59A08870F776529FECC9CBAFBCC\",\"PreviousTxnLgrSeq\":30963194}},{\"ModifiedNode\":{\"FinalFields\":{\"Account\":\"rLjDNH9g1AajRT2pxALZmwesd64p4x9XZJ\",\"Balance\":\"1818742784944\",\"Flags\":0,\"OwnerCount\":2544,\"Sequence\":239563},\"LedgerEntryType\":\"AccountRoot\",\"LedgerIndex\":\"7F28475BBAE8E0654C4D4C876DFBF7A3C40DEFEB6DF2F4C301F7F7F3514F255F\",\"PreviousFields\":{\"Balance\":\"1818743494555\",\"OwnerCount\":2545},\"PreviousTxnID\":\"B4E4D2547000ED85AA0047FF955661988851CB96C08F8B5BA8D5E3FB8E8BC71C\",\"PreviousTxnLgrSeq\":30963114}},{\"ModifiedNode\":{\"FinalFields\":{\"Account\":\"rLjDNH9g1AajRT2pxALZmwesd64p4x9XZJ\",\"BookDirectory\":\"59E6C90874EE6DE9C3187C89BE98BA49ADFCD5411C40488A4B1E8DA77F35822D\",\"BookNode\":\"0000000000000000\",\"Flags\":131072,\"OwnerNode\":\"0000000000001129\",\"Sequence\":239221,\"TakerGets\":\"32005901\",\"TakerPays\":{\"currency\":\"RJP\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0.02752507433058303\"}},\"LedgerEntryType\":\"Offer\",\"LedgerIndex\":\"7F8488EBFBEF1ABB5892611D62EC2104307EAB55F6161AFDC38AEF145134942C\",\"PreviousFields\":{\"TakerGets\":\"32692779\",\"TakerPays\":{\"currency\":\"RJP\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0.0281157893992212\"}},\"PreviousTxnID\":\"828C2F31471F06BBF27BF3D402048A579730A63E640E1B964309BBBB580E3A41\",\"PreviousTxnLgrSeq\":30958350}},{\"ModifiedNode\":{\"FinalFields\":{\"Flags\":0,\"IndexNext\":\"000000000000016A\",\"IndexPrevious\":\"0000000000000168\",\"Owner\":\"rKLPBY3nEhETSThEfWRaHNBH1Rxeo57UGn\",\"RootIndex\":\"4EE2F129C9DC8776082BD8AF7F769EF0EC9A661E740948B2B30B991212D499C8\"},\"LedgerEntryType\":\"DirectoryNode\",\"LedgerIndex\":\"8864C8088F0C84D37DFBD3CB63AA0F1816447BD3A3DF5F74FFC07841DBEC03E5\"}},{\"ModifiedNode\":{\"FinalFields\":{\"Flags\":0,\"IndexNext\":\"0000000000000154\",\"IndexPrevious\":\"0000000000000152\",\"Owner\":\"rKLPBY3nEhETSThEfWRaHNBH1Rxeo57UGn\",\"RootIndex\":\"4EE2F129C9DC8776082BD8AF7F769EF0EC9A661E740948B2B30B991212D499C8\"},\"LedgerEntryType\":\"DirectoryNode\",\"LedgerIndex\":\"9222A4355691E4C2C75545219628FDFDE75636D752C484467AE138D1125536A4\"}},{\"ModifiedNode\":{\"FinalFields\":{\"Account\":\"rKLPBY3nEhETSThEfWRaHNBH1Rxeo57UGn\",\"Balance\":\"1983393956692\",\"Flags\":0,\"OwnerCount\":2278,\"Sequence\":13534},\"LedgerEntryType\":\"AccountRoot\",\"LedgerIndex\":\"94D26520D7CA98F0B20082FD5BFC79389D1930F94F5D79734931F5076EAC75EA\",\"PreviousFields\":{\"Balance\":\"1983393247081\",\"OwnerCount\":2282},\"PreviousTxnID\":\"2337D78117E9A6EF15F0A67272D370F007AC0CA6F13B841B6341FDD331F8456A\",\"PreviousTxnLgrSeq\":30963202}},{\"DeletedNode\":{\"FinalFields\":{\"ExchangeRate\":\"590CB2E5F3EF2B54\",\"Flags\":0,\"RootIndex\":\"A7A2258942BF79A1C2A55DA88560879DC312966AFDD1CD05590CB2E5F3EF2B54\",\"TakerGetsCurrency\":\"0000000000000000000000004A50590000000000\",\"TakerGetsIssuer\":\"6F2531F2B8CDB96D6D986D9D75CC0156DF2C5387\",\"TakerPaysCurrency\":\"0000000000000000000000000000000000000000\",\"TakerPaysIssuer\":\"0000000000000000000000000000000000000000\"},\"LedgerEntryType\":\"DirectoryNode\",\"LedgerIndex\":\"A7A2258942BF79A1C2A55DA88560879DC312966AFDD1CD05590CB2E5F3EF2B54\"}},{\"DeletedNode\":{\"FinalFields\":{\"ExchangeRate\":\"590CB2E89DAA7608\",\"Flags\":0,\"RootIndex\":\"A7A2258942BF79A1C2A55DA88560879DC312966AFDD1CD05590CB2E89DAA7608\",\"TakerGetsCurrency\":\"0000000000000000000000004A50590000000000\",\"TakerGetsIssuer\":\"6F2531F2B8CDB96D6D986D9D75CC0156DF2C5387\",\"TakerPaysCurrency\":\"0000000000000000000000000000000000000000\",\"TakerPaysIssuer\":\"0000000000000000000000000000000000000000\"},\"LedgerEntryType\":\"DirectoryNode\",\"LedgerIndex\":\"A7A2258942BF79A1C2A55DA88560879DC312966AFDD1CD05590CB2E89DAA7608\"}},{\"DeletedNode\":{\"FinalFields\":{\"ExchangeRate\":\"590CB308061E49AB\",\"Flags\":0,\"RootIndex\":\"A7A2258942BF79A1C2A55DA88560879DC312966AFDD1CD05590CB308061E49AB\",\"TakerGetsCurrency\":\"0000000000000000000000004A50590000000000\",\"TakerGetsIssuer\":\"6F2531F2B8CDB96D6D986D9D75CC0156DF2C5387\",\"TakerPaysCurrency\":\"0000000000000000000000000000000000000000\",\"TakerPaysIssuer\":\"0000000000000000000000000000000000000000\"},\"LedgerEntryType\":\"DirectoryNode\",\"LedgerIndex\":\"A7A2258942BF79A1C2A55DA88560879DC312966AFDD1CD05590CB308061E49AB\"}},{\"DeletedNode\":{\"FinalFields\":{\"ExchangeRate\":\"590CB493BD366010\",\"Flags\":0,\"RootIndex\":\"A7A2258942BF79A1C2A55DA88560879DC312966AFDD1CD05590CB493BD366010\",\"TakerGetsCurrency\":\"0000000000000000000000004A50590000000000\",\"TakerGetsIssuer\":\"6F2531F2B8CDB96D6D986D9D75CC0156DF2C5387\",\"TakerPaysCurrency\":\"0000000000000000000000000000000000000000\",\"TakerPaysIssuer\":\"0000000000000000000000000000000000000000\"},\"LedgerEntryType\":\"DirectoryNode\",\"LedgerIndex\":\"A7A2258942BF79A1C2A55DA88560879DC312966AFDD1CD05590CB493BD366010\"}},{\"CreatedNode\":{\"LedgerEntryType\":\"Offer\",\"LedgerIndex\":\"C9FB798A9DF0CF089D35C9D4362BA6B1EA7A840C177E12E37A655CB5D39E7DC1\",\"NewFields\":{\"Account\":\"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\"BookDirectory\":\"DCAAC0CDAC8DA851AC8E225CA9ED9305CB4BBE7E4E255AB3590B8BDB97852000\",\"Flags\":131072,\"OwnerNode\":\"0000000000000018\",\"Sequence\":5598,\"TakerGets\":{\"currency\":\"RJP\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0.04938973491283533\"},\"TakerPays\":{\"currency\":\"JPY\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"1605.166384667149\"}}}},{\"ModifiedNode\":{\"FinalFields\":{\"Flags\":0,\"IndexPrevious\":\"0000000000000006\",\"Owner\":\"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\"RootIndex\":\"C5383B94DDE4BE2A184757D80837080C4D1EAB80789FE39F7D7AECFB0D0304BB\"},\"LedgerEntryType\":\"DirectoryNode\",\"LedgerIndex\":\"D38B8330B1FF06370FEBC6A6DCF8F72A9E03E1E41E613D265C5C531BFE11FD0C\"}},{\"DeletedNode\":{\"FinalFields\":{\"Account\":\"rKLPBY3nEhETSThEfWRaHNBH1Rxeo57UGn\",\"BookDirectory\":\"A7A2258942BF79A1C2A55DA88560879DC312966AFDD1CD05590CB2E89DAA7608\",\"BookNode\":\"0000000000000000\",\"Flags\":0,\"OwnerNode\":\"0000000000000154\",\"PreviousTxnID\":\"5CA1E45B04D3E99176A0D95EFD9F1039EE2959DD1BFCED89E7BF384092F3F448\",\"PreviousTxnLgrSeq\":30962746,\"Sequence\":12652,\"TakerGets\":{\"currency\":\"JPY\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0\"},\"TakerPays\":\"0\"},\"LedgerEntryType\":\"Offer\",\"LedgerIndex\":\"D5A5FD7E258772AF7143607278E28911C2810B465E10B8255E6A0DDE90D83B03\",\"PreviousFields\":{\"TakerGets\":{\"currency\":\"JPY\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"3.33481435285\"},\"TakerPays\":\"119200\"}}},{\"ModifiedNode\":{\"FinalFields\":{\"Balance\":{\"currency\":\"JPY\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"-11226126.07851087\"},\"Flags\":2228224,\"HighLimit\":{\"currency\":\"JPY\",\"issuer\":\"rKLPBY3nEhETSThEfWRaHNBH1Rxeo57UGn\",\"value\":\"50000000\"},\"HighNode\":\"0000000000000000\",\"HighQualityIn\":1000000000,\"LowLimit\":{\"currency\":\"JPY\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0\"},\"LowNode\":\"0000000000000323\"},\"LedgerEntryType\":\"RippleState\",\"LedgerIndex\":\"D727CD2D19774BA754A358FDFD2744A7563BB99ED4F0E9979A1B3565758D9A17\",\"PreviousFields\":{\"Balance\":{\"currency\":\"JPY\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"-11226145.97074262\"}},\"PreviousTxnID\":\"2337D78117E9A6EF15F0A67272D370F007AC0CA6F13B841B6341FDD331F8456A\",\"PreviousTxnLgrSeq\":30963202}},{\"CreatedNode\":{\"LedgerEntryType\":\"DirectoryNode\",\"LedgerIndex\":\"DCAAC0CDAC8DA851AC8E225CA9ED9305CB4BBE7E4E255AB3590B8BDB97852000\",\"NewFields\":{\"ExchangeRate\":\"590B8BDB97852000\",\"RootIndex\":\"DCAAC0CDAC8DA851AC8E225CA9ED9305CB4BBE7E4E255AB3590B8BDB97852000\",\"TakerGetsCurrency\":\"000000000000000000000000524A500000000000\",\"TakerGetsIssuer\":\"6F2531F2B8CDB96D6D986D9D75CC0156DF2C5387\",\"TakerPaysCurrency\":\"0000000000000000000000004A50590000000000\",\"TakerPaysIssuer\":\"6F2531F2B8CDB96D6D986D9D75CC0156DF2C5387\"}}},{\"DeletedNode\":{\"FinalFields\":{\"Account\":\"rLjDNH9g1AajRT2pxALZmwesd64p4x9XZJ\",\"BookDirectory\":\"59E6C90874EE6DE9C3187C89BE98BA49ADFCD5411C40488A4B1E8D82836FD9A4\",\"BookNode\":\"0000000000000000\",\"Flags\":131072,\"OwnerNode\":\"0000000000001128\",\"PreviousTxnID\":\"55AD7605531CC405E0EFB314B54E230465C92C4FE3087A6854E7DBE012D3D050\",\"PreviousTxnLgrSeq\":30958184,\"Sequence\":239189,\"TakerGets\":\"0\",\"TakerPays\":{\"currency\":\"RJP\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0\"}},\"LedgerEntryType\":\"Offer\",\"LedgerIndex\":\"E1071C902473C6A7E4AA542BE199B2D76488D264C6AE5C65422BEEB4533725D3\",\"PreviousFields\":{\"TakerGets\":\"22733\",\"TakerPays\":{\"currency\":\"RJP\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0.0000195500185265\"}}}},{\"DeletedNode\":{\"FinalFields\":{\"Account\":\"rKLPBY3nEhETSThEfWRaHNBH1Rxeo57UGn\",\"BookDirectory\":\"A7A2258942BF79A1C2A55DA88560879DC312966AFDD1CD05590CB2E5F3EF2B54\",\"BookNode\":\"0000000000000000\",\"Flags\":0,\"OwnerNode\":\"0000000000000169\",\"PreviousTxnID\":\"2337D78117E9A6EF15F0A67272D370F007AC0CA6F13B841B6341FDD331F8456A\",\"PreviousTxnLgrSeq\":30963202,\"Sequence\":13358,\"TakerGets\":{\"currency\":\"JPY\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0\"},\"TakerPays\":\"0\"},\"LedgerEntryType\":\"Offer\",\"LedgerIndex\":\"EED9E927385EA127101B7E199910C16DC79495141175B36BB85D316502BDE9CF\",\"PreviousFields\":{\"TakerGets\":{\"currency\":\"JPY\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"15.311714808375\"},\"TakerPays\":\"547302\"}}},{\"ModifiedNode\":{\"FinalFields\":{\"Balance\":{\"currency\":\"RJP\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"-283.1391043422258\"},\"Flags\":2228224,\"HighLimit\":{\"currency\":\"RJP\",\"issuer\":\"rLjDNH9g1AajRT2pxALZmwesd64p4x9XZJ\",\"value\":\"10000000000\"},\"HighNode\":\"0000000000000009\",\"HighQualityIn\":1000000000,\"LowLimit\":{\"currency\":\"RJP\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0\"},\"LowNode\":\"0000000000000012\"},\"LedgerEntryType\":\"RippleState\",\"LedgerIndex\":\"FAE9C113C6BAFF7BAD167E5D3B88F4DA967EC1E33FBB48CC0611B7E050FFA231\",\"PreviousFields\":{\"Balance\":{\"currency\":\"RJP\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"-283.1384940771389\"}},\"PreviousTxnID\":\"313C2A2F19CFD746A22E863C9B69844BBF83CD7A56A3612483EEBBF7A3388BEE\",\"PreviousTxnLgrSeq\":30958349}}],\"TransactionIndex\":1,\"TransactionResult\":\"tesSUCCESS\"},\"status\":\"closed\",\"transaction\":{\"Account\":\"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\"Fee\":\"120\",\"Flags\":2148007936,\"LastLedgerSequence\":30963206,\"Memos\":[{\"Memo\":{\"MemoData\":\"726D2D312E322E33\",\"MemoType\":\"636C69656E74\"}}],\"Sequence\":5598,\"SigningPubKey\":\"02E2F1208D1715E18B0957FC819546FA7434B4A19EE38321932D2ED28FA090678E\",\"TakerGets\":{\"currency\":\"RJP\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0.05\"},\"TakerPays\":{\"currency\":\"JPY\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"1625\"},\"TransactionType\":\"OfferCreate\",\"TxnSignature\":\"3045022100EE550D5083C4582E444B65BED185C97107147F1328363F53A65D7815D753929502206E0F42703F7F3530904670B18342D970CD797CABACCC72B181854606559BF78C\",\"date\":552403950,\"hash\":\"A945FBBC9D126B24268914D4650817F019D23E18E2D355B0A9BEA3EFD75F97F5\",\"owner_funds\":\"4.378619551666456\"},\"type\":\"transaction\",\"validated\":true}\n";
		c.filterTx(oneConsumesMany1);
		testOfferQuality(oneConsumesMany1);
		
//		System.out.println("2017-07-03, 22:37:11\n\n    sold 0.0493897 RJP.MrRipple at price 32,500.0 JPY.MrRipple. (order fully matched) ");		
//		String consumeNormal1 = "{\"engine_result\":\"tesSUCCESS\",\"engine_result_code\":0,\"engine_result_message\":\"The transaction was applied. Only final in a validated ledger.\",\"ledger_hash\":\"D3E1AE8E6B194F669755D29CD53061A5DAA8E55262EDA3C10555226C37BE84DE\",\"ledger_index\":30963282,\"meta\":{\"AffectedNodes\":[{\"ModifiedNode\":{\"FinalFields\":{\"Balance\":{\"currency\":\"JPY\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"23432.62554092779\"},\"Flags\":1114112,\"HighLimit\":{\"currency\":\"JPY\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0\"},\"HighNode\":\"0000000000000399\",\"LowLimit\":{\"currency\":\"JPY\",\"issuer\":\"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\"value\":\"100000\"},\"LowNode\":\"0000000000000001\"},\"LedgerEntryType\":\"RippleState\",\"LedgerIndex\":\"21110D01A36A7EB20188B11D685B847322DE631145C31803E1760550FA399BAD\",\"PreviousFields\":{\"Balance\":{\"currency\":\"JPY\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"21827.45915626065\"}},\"PreviousTxnID\":\"A945FBBC9D126B24268914D4650817F019D23E18E2D355B0A9BEA3EFD75F97F5\",\"PreviousTxnLgrSeq\":30963204}},{\"ModifiedNode\":{\"FinalFields\":{\"Balance\":{\"currency\":\"RJP\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"4.329131037283795\"},\"Flags\":1114112,\"HighLimit\":{\"currency\":\"RJP\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0\"},\"HighNode\":\"00000000000003FB\",\"LowLimit\":{\"currency\":\"RJP\",\"issuer\":\"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\"value\":\"10000\"},\"LowNode\":\"0000000000000006\",\"LowQualityIn\":1000000000},\"LedgerEntryType\":\"RippleState\",\"LedgerIndex\":\"4A8FE98984B510E3F0223CB8C9110FA370EC545BCD6CE6863C8405E5BC360423\",\"PreviousFields\":{\"Balance\":{\"currency\":\"RJP\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"4.378619551666456\"}},\"PreviousTxnID\":\"A945FBBC9D126B24268914D4650817F019D23E18E2D355B0A9BEA3EFD75F97F5\",\"PreviousTxnLgrSeq\":30963204}},{\"ModifiedNode\":{\"FinalFields\":{\"Account\":\"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\"Balance\":\"2734220398\",\"Flags\":0,\"OwnerCount\":9,\"Sequence\":5599},\"LedgerEntryType\":\"AccountRoot\",\"LedgerIndex\":\"72A59CDF8FFBF65C20D01D3A3D5DA5BAE3158A3881E7AEE525A01B1CC73D32DD\",\"PreviousFields\":{\"OwnerCount\":10},\"PreviousTxnID\":\"A945FBBC9D126B24268914D4650817F019D23E18E2D355B0A9BEA3EFD75F97F5\",\"PreviousTxnLgrSeq\":30963204}},{\"ModifiedNode\":{\"FinalFields\":{\"Balance\":{\"currency\":\"RJP\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"0.04938973491283533\"},\"Flags\":1114112,\"HighLimit\":{\"currency\":\"RJP\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0\"},\"HighNode\":\"0000000000000338\",\"LowLimit\":{\"currency\":\"RJP\",\"issuer\":\"rsPrWzpYp5jj278vHVgp1tMvbKdHAZGFbi\",\"value\":\"1000000000\"},\"LowNode\":\"0000000000000001\"},\"LedgerEntryType\":\"RippleState\",\"LedgerIndex\":\"7BE65D79F3087B4870A4E8596F1533D9761D53C05B0C51C1DEB5B0DA6A58C27C\",\"PreviousFields\":{\"Balance\":{\"currency\":\"RJP\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"0\"}},\"PreviousTxnID\":\"583C6A53D61102655A975944FDFD9EC65AE99C088438098CEE2E90B25AE169EA\",\"PreviousTxnLgrSeq\":30954974}},{\"ModifiedNode\":{\"FinalFields\":{\"Account\":\"rsPrWzpYp5jj278vHVgp1tMvbKdHAZGFbi\",\"Balance\":\"11674134881\",\"Flags\":0,\"OwnerCount\":35,\"Sequence\":6975397},\"LedgerEntryType\":\"AccountRoot\",\"LedgerIndex\":\"8881335E10619D1D17D4EB1FEF2647C232C892D377D9A34998C361FFFC9C4CCC\",\"PreviousFields\":{\"Balance\":\"11674159881\",\"Sequence\":6975396},\"PreviousTxnID\":\"16E5E9027F406ABA34EBA407663E8AE4185CDBFE837684B896505182A958F335\",\"PreviousTxnLgrSeq\":30963282}},{\"ModifiedNode\":{\"FinalFields\":{\"Balance\":{\"currency\":\"JPY\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"26495.13357511451\"},\"Flags\":1114112,\"HighLimit\":{\"currency\":\"JPY\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0\"},\"HighNode\":\"0000000000000232\",\"LowLimit\":{\"currency\":\"JPY\",\"issuer\":\"rsPrWzpYp5jj278vHVgp1tMvbKdHAZGFbi\",\"value\":\"1000000000\"},\"LowNode\":\"0000000000000000\"},\"LedgerEntryType\":\"RippleState\",\"LedgerIndex\":\"ADCD69C9DAFD1076DA7075D0E53667CB67EDD58675BD653162A7EA483E392851\",\"PreviousFields\":{\"Balance\":{\"currency\":\"JPY\",\"issuer\":\"rrrrrrrrrrrrrrrrrrrrBZbvji\",\"value\":\"28103.51029255099\"}},\"PreviousTxnID\":\"16E5E9027F406ABA34EBA407663E8AE4185CDBFE837684B896505182A958F335\",\"PreviousTxnLgrSeq\":30963282}},{\"DeletedNode\":{\"FinalFields\":{\"Account\":\"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\"BookDirectory\":\"DCAAC0CDAC8DA851AC8E225CA9ED9305CB4BBE7E4E255AB3590B8BDB97852000\",\"BookNode\":\"0000000000000000\",\"Flags\":131072,\"OwnerNode\":\"0000000000000018\",\"PreviousTxnID\":\"A945FBBC9D126B24268914D4650817F019D23E18E2D355B0A9BEA3EFD75F97F5\",\"PreviousTxnLgrSeq\":30963204,\"Sequence\":5598,\"TakerGets\":{\"currency\":\"RJP\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0\"},\"TakerPays\":{\"currency\":\"JPY\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0\"}},\"LedgerEntryType\":\"Offer\",\"LedgerIndex\":\"C9FB798A9DF0CF089D35C9D4362BA6B1EA7A840C177E12E37A655CB5D39E7DC1\",\"PreviousFields\":{\"TakerGets\":{\"currency\":\"RJP\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"0.04938973491283533\"},\"TakerPays\":{\"currency\":\"JPY\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"1605.166384667149\"}}}},{\"ModifiedNode\":{\"FinalFields\":{\"Flags\":0,\"IndexPrevious\":\"0000000000000006\",\"Owner\":\"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\"RootIndex\":\"C5383B94DDE4BE2A184757D80837080C4D1EAB80789FE39F7D7AECFB0D0304BB\"},\"LedgerEntryType\":\"DirectoryNode\",\"LedgerIndex\":\"D38B8330B1FF06370FEBC6A6DCF8F72A9E03E1E41E613D265C5C531BFE11FD0C\"}},{\"DeletedNode\":{\"FinalFields\":{\"ExchangeRate\":\"590B8BDB97852000\",\"Flags\":0,\"RootIndex\":\"DCAAC0CDAC8DA851AC8E225CA9ED9305CB4BBE7E4E255AB3590B8BDB97852000\",\"TakerGetsCurrency\":\"000000000000000000000000524A500000000000\",\"TakerGetsIssuer\":\"6F2531F2B8CDB96D6D986D9D75CC0156DF2C5387\",\"TakerPaysCurrency\":\"0000000000000000000000004A50590000000000\",\"TakerPaysIssuer\":\"6F2531F2B8CDB96D6D986D9D75CC0156DF2C5387\"},\"LedgerEntryType\":\"DirectoryNode\",\"LedgerIndex\":\"DCAAC0CDAC8DA851AC8E225CA9ED9305CB4BBE7E4E255AB3590B8BDB97852000\"}}],\"TransactionIndex\":58,\"TransactionResult\":\"tesSUCCESS\"},\"status\":\"closed\",\"transaction\":{\"Account\":\"rsPrWzpYp5jj278vHVgp1tMvbKdHAZGFbi\",\"Fee\":\"25000\",\"Flags\":131072,\"LastLedgerSequence\":30963284,\"Sequence\":6975396,\"SigningPubKey\":\"031161F2602A6746CA817D3EE4419F29641690CD613B015B923A2B8146BDEA7028\",\"TakerGets\":{\"currency\":\"JPY\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"281147.5169666801\"},\"TakerPays\":{\"currency\":\"RJP\",\"issuer\":\"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\"value\":\"8.647233936169537\"},\"TransactionType\":\"OfferCreate\",\"TxnSignature\":\"3045022100F81423D86B19CC03A06DB731C62B8DADA2C81E870A9D21A5A6C1BEE434671DBD02207E6BD95F48D128BE2DBC605355461F5D5E841A18295476F308188C6C54DAF369\",\"date\":552404231,\"hash\":\"9F259CBA609D8DDC6AD9D570646593CB9B173C91284057BD15053E1CBB00C07D\",\"owner_funds\":\"26495.13357511451\"},\"type\":\"transaction\",\"validated\":true}\n";
//		testOfferQuality(consumeNormal1);
//		c.filterTx(consumeNormal1);
		

	
	}
	
	public static void testOfferQuality(String raw) throws Exception {
		System.out.println("\n");
		System.out.println("\n");
		System.out.println("****NEW TX****");
		
		
		JSONObject transaction = new JSONObject(raw);
		JSONObject metaJSON = (JSONObject) transaction.remove("meta");
		TransactionMeta meta = (TransactionMeta) STObject.fromJSONObject(metaJSON);
		Transaction txn = (Transaction) STObject.fromJSONObject(transaction.getJSONObject("transaction"));

		if (txn.get(Field.TransactionType).toString().equals("OfferCrate")) {
			Amount gets = txn.get(Amount.TakerGets);
			Amount pays = txn.get(Amount.TakerPays);

			System.out.println("---------------------------------------------------------------");
			System.out.println("OfferCreate ");
			System.out.println("---------------------------------------------------------------");
			System.out.println("Get/Pay:    " + gets.currencyString() + "/" + pays.currencyString());
			System.out.println("Bid:        " + gets.computeQuality(pays));
			System.out.println("TakerPays:  " + pays);
			System.out.println("TakerGets:  " + gets);
		} else if (txn.get(Field.TransactionType).toString().equals("OfferCancel")) {
			System.out.println("---------------------------------------------------------------");
			System.out.println("OfferCancel ");
			System.out.println("---------------------------------------------------------------");
		} else if (txn.get(Field.TransactionType).toString().equals("Payment")) {
			System.out.println("---------------------------------------------------------------");
			System.out.println("Payment ");
			System.out.println("---------------------------------------------------------------");

		} else {
			System.out.println("---------------------------------------------------------------");
			System.out.println(txn.get(Field.TransactionType).toString());
			System.out.println("---------------------------------------------------------------");
		}

		System.out.println(txn.prettyJSON());
		ArrayList<AffectedNode> deletedNodes = new ArrayList<>();
		ArrayList<Offer> offersExecuted = new ArrayList<>();

		for (AffectedNode node : meta.affectedNodes()) {
			
			if (!node.isCreatedNode()) {
				// Merge fields from node / node.FinalFields && node.PreviousFields
				// to determine state of node prior to transaction.
				// Any fields that were in PreviousFields will  have their final
				// values
				// in a nested STObject keyed by FinalFields.
				LedgerEntry asPrevious = (LedgerEntry) node.nodeAsPrevious();
				// If it's an offer
				if(node.isDeletedNode()){
					deletedNodes.add(node);
				}
				if (asPrevious instanceof Offer) {
					// We can down-cast this to use Offer specific methods
					offersExecuted.add((Offer) asPrevious);
				}
			} else {
				LedgerEntry asFinal = (LedgerEntry) node.nodeAsPrevious();
				if (asFinal instanceof Offer) {
					Offer offer = (Offer) asFinal;						
					System.out.println("---------------------------------------------------------------");
					System.out.println("Offer Created");
					System.out.println("---------------------------------------------------------------");
					System.out.println("Get/Pay:    " + offer.getPayCurrencyPair());
					System.out.println("Bid:        " + offer.bidQuality());
					System.out.println("TakerPays:  " + offer.takerPays());
					System.out.println("TakerGets:  " + offer.takerGets());
					System.out.println("---------------------------------------------------------------");
					System.out.println(offer.prettyJSON());
				}
			}
		}
		
		deletedNodes.forEach(dn -> {
			LedgerEntry le = (LedgerEntry) dn.nodeAsFinal();
			STObject finalFields = dn.get(STObject.FinalFields);
			
			Hash256 previousTxnId = le.get(Hash256.PreviousTxnID);
			if (previousTxnId != null){
				System.out.println(previousTxnId.toString());

			}
		});

//		Collections.sort(offersExecuted, Offer.qualityAscending);
		for (Offer offer : offersExecuted) {
			STObject finalFields = offer.get(STObject.FinalFields);
			if (finalFields == null) {
				System.out.println("FinalFields is null");
//				System.out.println(offer.prettyJSON());

			} else {
				
				STObject executed = offer.executed(offer.get(STObject.FinalFields));
				// This will be computed from the BookDirectory field
				System.out.println("---------------------------------------------------------------");
				System.out.println("Offer Executed");
				System.out.println("---------------------------------------------------------------");
				System.out.println("Get/Pay: " + offer.getPayCurrencyPair());
				System.out.println("Ask:     " + offer.directoryAskQuality().stripTrailingZeros().toPlainString());
				System.out.println("Paid:    " + executed.get(Amount.TakerPays));
				System.out.println("Got:     " + executed.get(Amount.TakerGets));
				System.out.println("---------------------------------------------------------------");
				System.out.println(offer.prettyJSON());
			}

		}
		System.out.println("****END TX****");
		System.out.println("\n");
		System.out.println("\n");


}
}
